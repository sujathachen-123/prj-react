(function(g){var window=this;'use strict';var aq2=function(p){var C=new g.pw("und",new g.N6("Default","und",!0));C.captionTracks=p.captionTracks;return C},E30=function(p){return new g.um(function(C,V){var N=p.length,H=[];
if(N)for(var X=function(l,t){N--;H[l]=t;N==0&&C(H)},d=function(l){V(l)},a,E=0;E<p.length;E++)a=p[E],g.jcQ(a,g.Wv(X,E),d);
else C(H)})},Ai=function(p){this.T=p},oU=function(){Ai.apply(this,arguments)},lq0=function(){oU.apply(this,arguments)},tZE=function(){oU.apply(this,arguments)},cEY=function(){oU.apply(this,arguments)},Thf=function(){oU.apply(this,arguments)},MZv=function(){oU.apply(this,arguments)},JEp=function(){Ai.apply(this,arguments)},m_f=function(){oU.apply(this,arguments)},v3f=function(){oU.apply(this,arguments)},Fn5=function(){oU.apply(this,arguments)},SVv=function(){oU.apply(this,arguments)},Kn0=function(){oU.apply(this,
arguments)},D_1=function(){oU.apply(this,arguments)},ufE=function(){oU.apply(this,arguments)},ZEv=function(){oU.apply(this,arguments)},U_P=function(){oU.apply(this,arguments)},fq1=function(){oU.apply(this,arguments)},OEY=function(){oU.apply(this,arguments)},yE2=function(){oU.apply(this,arguments)},qV5=function(){Ai.apply(this,arguments)},Iq8=function(){oU.apply(this,arguments)},bEv=function(){oU.apply(this,arguments)},AEc=function(){oU.apply(this,arguments)},o3p=function(){oU.apply(this,arguments)},
ki1=function(){oU.apply(this,arguments)},x_F=function(){oU.apply(this,arguments)},YVr=function(){oU.apply(this,arguments)},zpf=function(){oU.apply(this,arguments)},Rpy=function(){oU.apply(this,arguments)},n32=function(){Ai.apply(this,arguments)},ep5=function(){Ai.apply(this,arguments)},Ppv=function(){Ai.apply(this,arguments)},w22=function(){oU.apply(this,arguments)},$_E=function(){oU.apply(this,arguments)},Lnc=function(){oU.apply(this,arguments)},g3y=function(){oU.apply(this,arguments)},Wn1=function(){oU.apply(this,
arguments)},Qsr=function(){oU.apply(this,arguments)},rEr=function(){oU.apply(this,arguments)},BhG=function(){oU.apply(this,arguments)},GiE=function(){oU.apply(this,arguments)},psY=function(){oU.apply(this,arguments)},CZG=function(){oU.apply(this,arguments)},jof=function(){oU.apply(this,arguments)},V1y=function(){oU.apply(this,arguments)},NT0=function(){oU.apply(this,arguments)},Hh1=function(){oU.apply(this,arguments)},Xsc=function(){oU.apply(this,arguments)},dk0=function(){oU.apply(this,arguments)},
ihF=function(){oU.apply(this,arguments)},hu1=function(){oU.apply(this,arguments)},sop=function(){oU.apply(this,arguments)},aeG=function(){oU.apply(this,arguments)},EcE=function(){oU.apply(this,arguments)},ler=function(){oU.apply(this,arguments)},t1y=function(){oU.apply(this,arguments)},cUp=function(){oU.apply(this,arguments)},TTY=function(){Ai.apply(this,arguments)},M1p=function(){oU.apply(this,arguments)},JUE=function(){oU.apply(this,arguments)},mkG=function(){oU.apply(this,arguments)},vcr=function(){oU.apply(this,
arguments)},Fgp=function(){oU.apply(this,arguments)},Shy=function(){oU.apply(this,arguments)},KgP=function(){oU.apply(this,arguments)},Dk5=function(){oU.apply(this,arguments)},uL2=function(){oU.apply(this,arguments)},Zh0=function(){oU.apply(this,arguments)},UkY=function(){oU.apply(this,arguments)},fep=function(){oU.apply(this,arguments)},OhY=function(){oU.apply(this,arguments)},yUp=function(){oU.apply(this,arguments)},qhr=function(){oU.apply(this,arguments)},Ie1=function(){oU.apply(this,arguments)},
bhv=function(){oU.apply(this,arguments)},AU2=function(){oU.apply(this,arguments)},ocy=function(){oU.apply(this,arguments)},kyy=function(){oU.apply(this,arguments)},xk0=function(){oU.apply(this,arguments)},Yhc=function(){oU.apply(this,arguments)},zuP=function(){oU.apply(this,arguments)},Ru0=function(){oU.apply(this,arguments)},nc8=function(){oU.apply(this,arguments)},eu2=function(){oU.apply(this,arguments)},PZG=function(){oU.apply(this,arguments)},wsf=function(){oU.apply(this,arguments)},$kp=function(){oU.apply(this,
arguments)},Lg1=function(p){p=p.key||p.id;
if(!p)throw Error("Entity key is missing");return p},gc0=function(){if(k8)return k8();
var p={};k8=g.HC("PersistentEntityStoreDb",{UK:(p.EntityStore={c_:1},p.EntityAssociationStore={c_:2},p),shared:!1,upgrade:function(C,V){V(1)&&g.Rp(g.A1(C,"EntityStore",{keyPath:"key"}),"entityType","entityType");V(2)&&(C=g.A1(C,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Rp(C,"byParentEntityKey","parentEntityKey"),g.Rp(C,"byChildEntityKey","childEntityKey"))},
version:3});return k8()},Wg2=function(p){return g.WW(gc0(),p)},QoE=function(p){return g.WW((0,g.yc2)(),p)},x8=function(p){this.token=p},Y8=function(p,C){C=C===void 0?{}:C;
g.Bw.call(this,g.qL1[p],Object.assign({},{name:"PESEncoderError",type:p},C));this.type=p;this.level="WARNING";Object.setPrototypeOf(this,Y8.prototype)},rUP=function(p){return new Y8("WRONG_DATA_TYPE",{qC:p})},BT0=function(p){return p instanceof Error?new Y8("UNKNOWN_ENCODE_ERROR",{xD:p.message}):new Y8("UNKNOWN_ENCODE_ERROR")},Gy0=function(p){return p instanceof Error?new Y8("UNKNOWN_DECODE_ERROR",{xD:p.message}):new Y8("UNKNOWN_DECODE_ERROR")},pfF=function(p,C){p=p instanceof Y8?p:C(p);
g.nm(p);throw p;},C41=function(){},j9F=function(p,C,V){try{return p.V(C,V)}catch(N){pfF(N,BT0)}},Vhy=function(p){p=(new TextEncoder).encode(p).subarray(0,16);
var C=new Uint8Array(16);C.set(p);return C},za=function(p){this.T=p},H2Y=function(p){var C=N9F[p];
if(C)return C;g.eG(new g.Bw("Entity model not found.",{entityType:p}))},Xfr=function(p,C){this.T=p;
this.C=C;this.V={}},i2G=function(p,C){a:{p=dKp(p.C,C.version);
try{var V=p.C(C.data,C.key);break a}catch(N){pfF(N,Gy0)}V=void 0}return V},RU=function(p,C,V){return p.T.objectStore("EntityStore").get(C).then(function(N){if(N){if(V&&N.entityType!==V)throw Error("Incorrect entity type");
return i2G(p,N)}})},nC=function(p,C,V){return V?(V=V.map(function(N){return RU(p,N,C)}),g.f3.all(V)):p.T.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(C)).then(function(N){return N.map(function(H){return i2G(p,H)})})},P9=function(p,C,V){var N=Lg1(C),H=dKp(p.C,1),X=Object.assign({},C);
return p.T.objectStore("EntityStore").get(N).then(function(d){if(d){if(d.entityType!==V)throw Error("Incorrect entity type");X.entityMetadata||(d=i2G(p,d),X.entityMetadata=d.entityMetadata)}}).then(function(){var d={key:N,
entityType:V,data:j9F(H,X,N),version:1};return g.f3.all([g.xt(p.T.objectStore("EntityStore"),d),hUc(p,X,V)])}).then(function(){eN(p,N,V);
return N})},s9F=function(p,C,V){C=C.map(function(N){return P9(p,N,V)});
return g.f3.all(C)},wp=function(p,C,V){if(V==null?0:V.Yr){var N=new Set;
return aoy(p,C,N).then(function(){for(var X=[],d=g.F(N),a=d.next();!a.done;a=d.next())X.push(wp(p,a.value));return g.f3.all(X).then(function(){})})}var H=g.tq(C).entityType;
return g.f3.all([p.T.objectStore("EntityStore").delete(C),Eoc(p,C)]).then(function(){eN(p,C,H)})},lo8=function(p,C){return g.wq(p.T.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(C)},function(V){return g.f3.all([V.delete(),
Eoc(p,V.cursor.primaryKey)]).then(function(){eN(p,V.cursor.primaryKey,C);return g.e_(V)})})},thE=function(p,C,V,N){var H=dKp(p.C,1);
return RU(p,C,N).then(function(X){if(X){X=g.Ad(X,V);var d={key:C,entityType:N,data:j9F(H,X,C),version:1};return g.f3.all([g.xt(p.T.objectStore("EntityStore"),d),hUc(p,X,N)])}}).then(function(){eN(p,C,N);
return C})},eN=function(p,C,V){var N=p.V[V];
N||(N=new Set,p.V[V]=N);N.add(C)},cxE=function(p,C,V){var N=Lg1(C);
V=H2Y(V);if(!V)return g.f3.resolve([]);V=new V(C);p=p.T.objectStore("EntityAssociationStore");C=[];V=g.F(V.C());for(var H=V.next();!H.done;H=V.next())C.push(g.xt(p,{parentEntityKey:N,childEntityKey:H.value}));return g.f3.all(C).then(function(X){return X.map(function(d){return d[1]})})},Eoc=function(p,C){return p.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(C))},hUc=function(p,C,V){var N=Lg1(C);
return Eoc(p,N).then(function(){return cxE(p,C,V)})},aoy=function(p,C,V){if(V.has(C))return g.f3.resolve(void 0);
V.add(C);return T91(p,C).then(function(N){return p.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(C)).then(function(){return N})}).then(function(N){var H=g.f3.resolve(void 0);
N=g.F(N);for(var X=N.next(),d={};!X.done;d={dC:void 0},X=N.next())d.dC=X.value,H=H.then(function(a){return function(){return aoy(p,a.dC,V)}}(d));
return H}).then(function(){})},T91=function(p,C){var V=p.T.objectStore("EntityAssociationStore");
return V.index("byParentEntityKey").getAll(IDBKeyRange.only(C)).then(function(N){var H=[];N=g.F(N);for(var X=N.next();!X.done;X=N.next())X=X.value,H.push(V.index("byChildEntityKey").getAll(X.childEntityKey));return g.f3.all(H)}).then(function(N){var H=[];
N=g.F(N);for(var X=N.next();!X.done;X=N.next())X=X.value,X.length===1&&H.push(X[0].childEntityKey);return H})},$8=function(){},MhF=function(){this.T={};
this.T[0]=new $8;if(!g.Zr("aes_pes_encoder_killswitch")){var p=this.T;try{var C=g.GW();var V=Vhy(C);var N=new za(new g.yi(V),new g.OF(V))}catch(H){throw p=H instanceof Error?new Y8("KEY_CREATION_FAILED",{xD:H.message}):new Y8("KEY_CREATION_FAILED"),g.nm(p),p;}p[1]=N}},dKp=function(p,C){C=C===void 0?0:C;
p=p.T[C];if(!p)throw C=new Y8("INVALID_ENCODER_VERSION",{qC:C}),g.nm(C),C;return p},LC=function(p,C){g.Y.call(this);
this.token=p;this.T=C;this.observers=[];p=new g.xH.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.GW());p.onmessage=this.C.bind(this);this.channel=p},gp=function(p,C,V){var N,H,X,d;
return g.I(function(a){if(a.C==1)return g.y(a,Wg2(p.token),2);if(a.C!=3)return N=a.T,g.y(a,g.kt(N,["EntityStore","EntityAssociationStore"],C,function(E){H=new Xfr(E,p.T);return V(H)}),3);
X=a.T;H&&(d=H.V,Object.keys(d).length>0&&(p.channel.postMessage(d),Jxp(p,d)));return a.return(X)})},W9=function(p,C,V){return gp(p,{mode:"readwrite",
L4:!0},function(N){return P9(N,C,V)})},mKE=function(p,C){return gp(p,{mode:"readwrite",
L4:!0},function(V){return s9F(V,C,"offlineOrchestrationActionWrapperEntity")})},vo8=function(p,C){return gp(p,{mode:"readwrite",
L4:!0},function(V){return wp(V,C)})},FGP=function(p){return gp(p,{mode:"readwrite",
L4:!0},function(C){return lo8(C,"videoPlaybackPositionEntity")})},Qa=function(p,C,V){return gp(p,{mode:"readonly",
L4:!0},function(N){return RU(N,C,V)})},rp=function(p,C,V){return gp(p,{mode:"readonly",
L4:!0},function(N){return nC(N,C,V)})},Jxp=function(p,C){p=g.F(p.observers);
for(var V=p.next();!V.done;V=p.next())V=V.value,V(C)},SE1=function(){var p,C,V;
return g.I(function(N){if(N.C==1)return g.vv(N,2),g.y(N,g.Vt(),4);if(N.C!=2){p=N.T;if(!p||!g.p3()||typeof g.xH.BroadcastChannel==="undefined")return N.return();C=new MhF;return N.return(new LC(p,C))}V=g.Sa(N);V instanceof Error&&g.nm(V);return N.return()})},B9=function(){KG0||(KG0=SE1());
return KG0},DK8=function(p){var C;
p=(C=p.options)==null?void 0:C.persistenceOption;return p==="ENTITY_PERSISTENCE_OPTION_PERSIST"||p==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},ujP=function(p){var C;
return g.I(function(V){return V.C==1?g.y(V,B9(),2):(C=V.T)?g.y(V,gp(C,"readwrite",function(N){for(var H={},X=g.F(p),d=X.next(),a={};!d.done;a={vB:void 0,xx:void 0},d=X.next())a.vB=d.value,a.vB.entityKey&&DK8(a.vB)&&(a.xx=g.yW(a.vB.payload),d=void 0,a.vB.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(d=function(E){return function(){return P9(N,E.vB.payload[E.xx],E.xx)}}(a)),a.vB.type==="ENTITY_MUTATION_TYPE_DELETE"&&(d=function(E){return function(){return wp(N,E.vB.entityKey)}}(a)),a.vB.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(d=function(E){return function(){return thE(N,E.vB.entityKey,E.vB.payload[E.xx],E.xx)}}(a)),d&&(H[a.vB.entityKey]=H[a.vB.entityKey]?H[a.vB.entityKey].then(d):d()));
return g.f3.all(Object.values(H))}),0):V.return()})},Z21=function(p){var C;
return g.I(function(V){if(V.C==1){C=p.mutations;if(!C||C.length<=0)return V.return();if(g.Xx){var N={type:"ENTITY_LOADED"};C!==void 0&&(N.payload=C);g.Xx.dispatch(N)}return g.y(V,ujP(C),2)}C.length=0;g.JQ(V)})},UKP=function(p){return p!==void 0},fof=function(p){var C=g.Kk();
C=Object.assign({},C);p=Object.assign({},p);for(var V in C)p[V]?(C[V]!==4&&(C[V]=p[V]),delete p[V]):C[V]!==2&&(C[V]=4);Object.assign(C,p);g.WHy(C);JSON.stringify(C);return C},O20=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,g.Vt(),2);if(N.C!=3)return(C=N.T)?g.y(N,g.Zb(C),3):N.return();V=N.T;return N.return(g.kt(V,["index","media","captions"],{mode:"readwrite",L4:!0},function(H){var X=IDBKeyRange.bound(p+"|",p+"~");H=[H.objectStore("index").delete(X),H.objectStore("media").delete(X),H.objectStore("captions").delete(X)];return g.f3.all(H).then(function(){})}))})},yxG=function(){var p,C;
return g.I(function(V){if(V.C==1)return g.y(V,g.Vt(),2);if(V.C!=3){p=V.T;if(!p)throw g.Z1("rvdfd");return g.y(V,g.Zb(p),3)}C=V.T;return V.return(g.kt(C,["index","media"],{mode:"readwrite",L4:!0},function(N){var H={};return g.n3(N.objectStore("index"),{},function(X){var d=X.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),a=g.f3.resolve(void 0);if(d){var E=d[1];d=d[2];H[E]=H[E]||{};var l;H[E][d]=g.pYv((l=X.getValue())==null?void 0:l.fmts)}else a=X.delete().then(function(){});
return g.f3.all([g.e_(X),a]).then(function(t){return g.F(t).next().value})}).then(function(){for(var X={},d=g.F(Object.keys(H)),a=d.next();!a.done;a=d.next()){a=a.value;
var E=H[a].v;X[a]=H[a].a&&E?1:2}var l=fof(X);return g.oI9(N.objectStore("media"),{},function(t){var c=t.cursor.key.match(g.Nre);c&&X[c[1]]||N.objectStore("media").delete(t.cursor.key);return g.ZXe(t)}).then(function(){return l})})}))})},qEP=function(p,C){var V,N;
return g.I(function(H){if(H.C==1)return g.y(H,g.Vt(),2);if(H.C!=3){V=H.T;if(!V)throw g.Z1("wct");return g.y(H,g.Zb(V),3)}N=H.T;return g.y(H,g.kt(N,["captions"],{mode:"readwrite",L4:!0},function(X){var d=[];X=X.objectStore("captions");for(var a=0;a<C.length;a++){var E=g.xt(X,C[a],p+"|"+C[a].metadata.vss_id);d.push(E)}return g.f3.all(d)}),0)})},Iop=function(p){var C,V,N;
return g.I(function(H){if(H.C==1)return C=IDBKeyRange.bound(p+"|",p+"~"),g.y(H,g.Vt(),2);if(H.C!=3){V=H.T;if(!V)throw g.Z1("gactfv");return g.y(H,g.Zb(V),3)}N=H.T;return H.return(N.getAll("captions",C))})},b2f=function(p){return g.I(function(C){g.us(p,0);
return C.return(O20(p))})},Axy=function(p){return{context:g.Za(),
videoIds:p}},ooP=function(p){return{context:g.Za(),
playlistIds:p}},kuP=function(p){return{context:g.Za(),
offlinePlaylistSyncChecks:p}},xKv=function(){this.T=new Map},zUG=function(){YE8||(YE8=new xKv);
return YE8},RUf=function(p,C){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:p},metadata:C,statusCode:void 0,csn:void 0,can:void 0}},noY=function(p,C,V){if(!V){var N=N===void 0?!1:N;
V=p.T.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!V||N)V=g.OI(16),p.T.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",V)}p={flowNonce:V,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:C.eventType};C.metadata&&(p.flowMetadata=C.metadata);C.statusCode!==void 0&&(p.flowEventStatus=C.statusCode);C.csn&&(p.csn=C.csn);C.can&&(p.can=C.can);g.t1("flowEvent",p,void 0)},eUy=function(p){var C,V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc,OS,V8,Tp,Bv,u,U,O;
return g.I(function(b){if(b.C==1)return g.y(b,gp(p,{mode:"readonly",L4:!0},function(x){return nC(x,"playbackData").then(function(pY){var d1=pY.map(function(my){return my.transfer}).filter(function(my){return!!my}),Hv=pY.map(function(my){return my.offlineVideoPolicy}).filter(function(my){return!!my}),k=pY.filter(function(my){return!!my.key}).map(function(my){return g.cJ(g.tq(my.key).entityId,"downloadStatusEntity")});
d1=nC(x,"transfer",d1);Hv=nC(x,"offlineVideoPolicy",Hv);k=nC(x,"downloadStatusEntity",k);var ES=d1.then(function(my){my=my.reduce(function(i9,kH){(kH==null?0:kH.offlineVideoStreams)&&i9.push.apply(i9,g.K(kH.offlineVideoStreams));return i9},[]).filter(function(i9){return!!i9});
return nC(x,"offlineVideoStreams",my)});
return g.f3.all([d1,Hv,ES,k]).then(function(my){var i9=g.F(my);my=i9.next().value;var kH=i9.next().value;var hf=i9.next().value;i9=i9.next().value;return[pY,my,kH,hf,i9]})})}),2);
if(b.C!=3)return C=b.T,g.y(b,gp(p,{mode:"readonly",L4:!0},function(x){return nC(x,"mainDownloadsListEntity").then(function(pY){var d1,Hv;return(Hv=(d1=pY[0])==null?void 0:d1.downloads)!=null?Hv:[]})}),3);
V=b.T;N=g.F(C);H=N.next().value;X=N.next().value;d=N.next().value;a=N.next().value;E=N.next().value;l=H;t=X;c=d;T=a;M=E;J={};S={};D={};Z={};f={};q=[];A=g.F(t);for(z=A.next();!z.done;z=A.next())(Q=z.value)&&(J[Q.key]=Q);P=g.F(c);for(VL=P.next();!VL.done;VL=P.next())(au=VL.value)&&(S[au.key]=au);W=g.F(M);for(e=W.next();!e.done;e=W.next())(B=e.value)&&(D[B.key]=B);v=g.F(T);for(w=v.next();!w.done;w=v.next())(C0=w.value)&&(Z[C0.key]=C0);FG=g.F(V);for(Nc=FG.next();!Nc.done;Nc=FG.next())OS=Nc.value,V8=void 0,
f[(V8=OS.videoItem)!=null?V8:""]=!0,OS.videoItem&&(Bv=Tp=void 0,u=(Bv=(Tp=g.tq(OS.videoItem))==null?void 0:Tp.entityId)!=null?Bv:"",q.push({externalVideoId:u}));U=l.filter(function(x){if(!x||!x.key||!x.offlineVideoPolicy)return!1;x=g.tq(x.key).entityId;x=g.cJ(x,"downloadStatusEntity");var pY;return!(x&&((pY=D[x])==null?void 0:pY.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
O=U.map(function(x){var pY=J[x.transfer],d1=[];if(pY==null?0:pY.offlineVideoStreams)for(var Hv=g.F(pY.offlineVideoStreams),k=Hv.next();!k.done;k=Hv.next())(k=Z[k.value])&&d1.push(k);Hv=S[x.offlineVideoPolicy];k=f;var ES=x==null?void 0:x.playerResponseTimestamp,my=g.tq(Hv.key).entityId;x=g.cJ(my,"mainVideoEntity");if(Hv.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var i9="OFFLINE_VIDEO_STATE_DISABLED";Hv.expirationTimestamp&&Number(Hv.expirationTimestamp)<Date.now()/1E3&&(i9="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Hv.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")i9="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(pY==null?void 0:pY.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":i9="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":i9="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":i9="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":i9="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":i9="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":i9="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:i9="OFFLINE_VIDEO_STATE_UNKNOWN"}if(i9==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(pY==null?void 0:pY.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":i9="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":i9="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":i9=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}my={id:my,videoState:i9};if(pY==null?0:pY.cotn)my.cotn=pY.cotn;if(pY==null?0:pY.maximumDownloadQuality)my.selectedVideoQuality=pY==null?void 0:pY.maximumDownloadQuality;if(pY==null?0:pY.lastProgressTimeMs)my.lastProgressTimeMs=pY.lastProgressTimeMs;ES&&(my.playerResponseSavedTimeMs=String(Number(ES)*1E3));pY=String;ES=0;d1=g.F(d1);for(i9=d1.next();!i9.done;i9=d1.next())if(i9=i9.value,i9.streamsProgress){i9=g.F(i9.streamsProgress);for(var kH=i9.next();!kH.done;kH=
i9.next()){var hf=void 0;ES+=Number((hf=kH.value.numBytesDownloaded)!=null?hf:0)}}my.downloadedBytes=pY(ES);my.selectedOfflineMode=k[x]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Hv.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(my.offlinePlaybackDisabledReason=Hv.offlinePlaybackDisabledReason);return my});
return b.return({offlineVideos:O,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:q}}})})},P4E=function(){this.locks=navigator.locks},wf2=function(){try{var p=g.zV("ytglobal.locks_");
if(p)return p;var C;if(C=navigator){var V=navigator;C="locks"in V&&!!V.locks}if(C)return g.xH.localStorage&&g.xH.localStorage.getItem("noop"),p=new P4E,g.YH("ytglobal.locks_",p),p}catch(N){}},Ga=function(){},$K2=function(){},LGv=function(p){if(p.includes(":"))throw Error("Invalid user cache name: "+p);
return p+":"+g.GW("CacheStorage get")},goG=function(){return g.I(function(p){if(p8!==void 0)return p.return(p8);
p8=new Promise(function(C){var V;return g.I(function(N){switch(N.C){case 1:return g.vv(N,2),g.y(N,C8.open("test-only"),4);case 4:return g.y(N,C8.delete("test-only"),5);case 5:g.Fe(N,3);break;case 2:if(V=g.Sa(N),V instanceof Error&&V.name==="SecurityError")return C(!1),N.return();case 3:C("caches"in window),g.JQ(N)}})});
return p.return(p8)})},Q9p=function(){return g.I(function(p){if(p.C==1)return g.y(p,goG(),2);
if(!p.T)return p.return(void 0);WGf||(WGf=new $K2);return p.return(WGf)})},jx=function(p,C,V){g.eG(new g.Bw("Woffle: "+p,V?{cotn:V}:""));
C instanceof Error&&g.eG(C)},rx2=function(p){var C;
return g.I(function(V){if(V.C==1)return g.y(V,eUy(p),2);C=V.T;g.t1("offlineStateSnapshot",C);g.JQ(V)})},VZ=function(p){g.Y.call(this);
var C=this;this.api=p;this.Sr={KbY:function(){return C.T},
kzk:function(){return C.C}};
typeof g.xH.BroadcastChannel!=="undefined"&&(this.T=new g.xH.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.GW()),this.T.onmessage=this.V.bind(this),this.C=new g.xH.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.GW()),this.C.onmessage=this.S.bind(this))},Nw=function(p,C){p.api.Jk("onOfflineOperationFailure",C);
var V;(V=p.T)==null||V.postMessage(C)},B9p=function(p,C,V,N){var H=this;
this.J=p;this.Z=C;this.visibility=V;this.G=N;this.W=this.D=this.Y=this.V=this.T=!1;this.S=new g.N8(function(){H.j8()});
this.Sr={Ks:function(){return H.C},
j8:function(){H.j8()},
sak:function(){return H.S}};
this.visibility.subscribe("visibilitystatechange",function(){H.JE()})},Gu5=function(p){if(!p.V&&!p.T){var C=wf2();
if(C){p.V=!0;var V=g.GW("OfflineLockManager");C.request("woffle_orchestration_leader:"+V,{},function(){var N,H,X,d;return g.I(function(a){switch(a.C){case 1:return g.vv(a,2),p.C=new g.Zt,p.T=!0,p.V=!1,g.y(a,p.J(),4);case 4:return g.y(a,p.C.promise,5);case 5:g.Fe(a,0);break;case 2:N=g.Sa(a),((X=(H=p).G)==null?0:X.call(H,"wo_relinquish_leadership_on_lock_request_error"))||p.j8(),N instanceof Error&&(d=N,d.args=[{name:"WoLockManagerError",z5:N.name}],g.nm(d)),g.JQ(a)}})})}}},ppr=function(p){p.T&&(p.W=
!0,HK(p))},Cfv=function(p,C){p.T&&(p.Y=C,HK(p))},j1f=function(p,C){p.T&&(p.D=C,HK(p))},HK=function(p){p.D&&p.Y&&p.W&&p.visibility.isBackground()?g.HF(p.S,6E4):p.S.stop()},Xh=function(p){var C;
p.offlineDeleteReason=(C=p.offlineDeleteReason)!=null?C:"OFFLINE_DELETE_REASON_UNKNOWN";var V;p.offlineModeType=(V=p.offlineModeType)!=null?V:"OFFLINE_NOW";g.t1("offlineDeleteEvent",p)},dQ=function(p,C){var V=C.videoId;
var N=C.NB;C=C.offlineModeType;p.encryptedVideoId=V;p.cotn=N==null?void 0:N.cotn;p.offlineabilityFormatType=N==null?void 0:N.maximumDownloadQuality;var H;p.isRefresh=(H=N==null?void 0:N.isRefresh)!=null?H:!1;var X;p.softErrorCount=(X=N==null?void 0:N.transferRetryCount)!=null?X:0;p.offlineModeType=C!=null?C:"OFFLINE_NOW";(p.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&p.statusType==="UNKNOWN_STATUS_TYPE"||!p.transferStatusType&&!p.statusType)&&g.eG(Error("Woffle unknown transfer status"));
g.t1("offlineTransferStatusChanged",p)},Vrr=function(p,C,V,N){N={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!N};C&&V&&(C=Math.floor(C/1024).toFixed(),V=Math.floor(V/1024).toFixed(),N.alreadyDownloadedKbytes=C,N.totalFetchedKbytes=C,N.totalContentKbytes=V);dQ(N,p)},NxP=function(p){dQ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},p)},Hor=function(p){switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
il=function(p){var C,V,N;
return((N=(C=p.actionMetadata)==null?void 0:(V=C.retryScheduleIntervalsInSeconds)==null?void 0:V.length)!=null?N:0)>0},hg=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!p.entityKey},az=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!p.entityKey},Es=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!p.entityKey},XpG=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!p.entityKey},
ll=function(p,C,V,N,H){H=H===void 0?!1:H;
var X,d,a,E,l,t;return g.I(function(c){if(c.C==1)return X=g.cJ(p,C),d=g.cJ(p,"downloadStatusEntity"),g.y(c,gp(V,{mode:"readonly",L4:!0},function(T){return g.f3.all([RU(T,X,C),RU(T,d,"downloadStatusEntity")])}),2);
a=c.T;E=a.length?a[0]:void 0;if(!E)return c.EY(0);l=dZv;if(t=a.length>1?a[1]:void 0){if(t.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!H)return c.return();t.downloadState=N}else t={key:d,downloadState:N};g.g7(E,l,t);return g.y(c,gp(V,{mode:"readwrite",L4:!0},function(T){return g.f3.all([P9(T,E,C),P9(T,t,"downloadStatusEntity")])}),0)})},tg=function(p,C){return p.actionType===C.actionType&&p.entityKey===C.entityKey},cK=function(p,C){if(p&&p.transferState!=="TRANSFER_STATE_COMPLETE"&&p.transferState!==
"TRANSFER_STATE_FAILED"){var V=g.tq(p.key).entityId;
dQ({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:V,NB:p,offlineModeType:C})}},TY=function(p){if(!p||!p.thumbnails)return[];
var C=[];p=g.F(p.thumbnails);for(var V=p.next();!V.done;V=p.next())V=V.value,V.url&&C.push(V.url);return C},ioE=function(p,C,V){V=V===void 0?[]:V;
var N,H,X,d,a,E,l,t,c,T,M,J,S;return g.I(function(D){if(D.C==1)return V.length?g.y(D,rp(p,C),2):D.return([]);N=D.T;H=new Set;X=g.F(N);for(d=X.next();!d.done;d=X.next())if(a=d.value,E=a.id||a.key)l=g.tq(E).entityId,H.add(l);t=[];c=g.F(V);for(T=c.next();!T.done;T=c.next())M=T.value,J=M.offlineVideoData,S=void 0,((S=J)==null?0:S.videoId)&&!H.has(J.videoId)&&t.push(M);return D.return(t)})},hz8=function(p,C,V){return new g.YB(p,{cotn:C,
raw_player_response:V,download_media:!0,start:Infinity,disable_watch_next:!0})},s1Y=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Mw=function(p,C,V,N,H,X,d,a,E,l,t){this.entityType=p;
this.actionId=C;this.action=V;this.parentActionId=N;this.rootActionId=H===void 0?C:H;this.childActionIds=X;this.prereqActionId=d;this.postreqActionIds=a;this.hasChildActionFailed=l;this.retryScheduleIndex=0;this.T=t||Date.now();this.retryScheduleIndex=E||0},Jg=function(p){if(!p.key)throw Error("Entity key is required.");
if(!p.actionProto)throw Error("OfflineOrchestrationAction is required.");var C=g.tq(p.key),V=g.tq(p.actionProto.entityKey);return new Mw(V.entityType,C.entityId,p.actionProto,p.parentActionId,p.rootActionId,p.childActionIds,p.prereqActionId,p.postreqActionIds,p.retryScheduleIndex,p.hasChildActionFailed,Number(p.enqueueTimeSec)*1E3)},vK=function(p){return{key:g.cJ(p.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:p.action,parentActionId:p.parentActionId,rootActionId:p.rootActionId,childActionIds:p.childActionIds,prereqActionId:p.prereqActionId,postreqActionIds:p.postreqActionIds,retryScheduleIndex:p.retryScheduleIndex,hasChildActionFailed:p.hasChildActionFailed,enqueueTimeSec:(p.T/1E3).toFixed()}},aA1=function(){var p;
return g.I(function(C){return C.C==1?g.y(C,Q9p(),2):(p=C.T)?C.return(p.delete("yt-player-local-img")):C.return(!0)})},Fh=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,Q9p(),2);if(N.C!=3){C=N.T;if(!C)throw Error("Cache API not supported");return p.length?g.y(N,C.open("yt-player-local-img"),3):N.return()}V=N.T;return g.y(N,Promise.all(p.map(function(H){return V.delete(H)})),0)})},Sx=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,Q9p(),2);if(N.C!=3){C=N.T;if(!C)throw Error("Cache API not supported");return p.length?g.y(N,C.open("yt-player-local-img"),3):N.return()}V=N.T;return g.y(N,V.addAll(p),0)})},K8=function(p,C,V,N,H){var X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc,OS,V8;
return g.I(function(Tp){switch(Tp.C){case 1:return X=g.cJ(p,"mainVideoEntity"),d=g.cJ(p,"ytMainChannelEntity"),a=g.cJ(p,"transfer"),E=g.cJ(p,"videoDownloadContextEntity"),g.y(Tp,gp(C,{mode:"readonly",L4:!0},function(Bv){return g.f3.all([RU(Bv,X,"mainVideoEntity"),RU(Bv,d,"ytMainChannelEntity"),RU(Bv,a,"transfer"),RU(Bv,E,"videoDownloadContextEntity"),nC(Bv,"ytMainChannelEntity"),nC(Bv,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:l=Tp.T;t=g.F(l);c=t.next().value;T=t.next().value;M=t.next().value;J=t.next().value;S=t.next().value;D=t.next().value;Z=c;f=T;q=M;A=J;z=S;Q=D;if(!Z&&!f){Tp.EY(3);break}P=Z?TY(Z.thumbnail):[];if(!f){VL=[];Tp.EY(4);break}return g.y(Tp,ECP(f,z),5);case 5:VL=Tp.T;case 4:return au=VL,g.y(Tp,Fh(P.concat(au)),3);case 3:W=[];e=g.cJ(p,"downloadStatusEntity");B=g.F(Q);for(v=B.next();!v.done;v=B.next())w=v.value,C0=g.tq(w.key).entityId,FG=Jg(w),Nc=g.tq(FG.action.entityKey).entityId,C0!==p&&Nc!==p||tg(V,
w.actionProto)||W.push(w.key);return g.y(Tp,gp(C,{mode:"readwrite",L4:!0},function(Bv){var u=W.map(function(U){return wp(Bv,U)});
u.push(wp(Bv,X,{Yr:!0}));u.push(wp(Bv,e,{Yr:!0}));return g.f3.all(u)}),7);
case 7:V8=(OS=A)==null?void 0:OS.offlineModeType,H&&(Xh(H),H.offlineModeType&&(V8=H.offlineModeType)),cK(q,V8),Nw(N,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.JQ(Tp)}})},cT2=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc,OS,V8,Tp,Bv,u,U,O,b,x,pY,d1,Hv,k,ES,my,i9,kH,hf,RF,cy;
return g.I(function(g1){switch(g1.C){case 1:return H=g.cJ(p,"mainPlaylistEntity"),X=g.cJ(p,"ytMainChannelEntity"),g.y(g1,gp(C,{mode:"readonly",L4:!0},function(zt){return g.f3.all([RU(zt,H,"mainPlaylistEntity"),RU(zt,X,"ytMainChannelEntity"),nC(zt,"mainPlaylistEntity"),nC(zt,"mainDownloadsListEntity"),nC(zt,"ytMainChannelEntity"),nC(zt,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=g1.T;a=g.F(d);E=a.next().value;l=a.next().value;t=a.next().value;c=a.next().value;T=a.next().value;M=a.next().value;J=E;S=l;D=t;Z=c;f=T;q=M;if(!J&&!S){g1.EY(3);break}A=J?lA0(J):[];if(!S){z=[];g1.EY(4);break}return g.y(g1,ECP(S,f),5);case 5:z=g1.T;case 4:return Q=z,g.y(g1,Fh(A.concat(Q)),3);case 3:P=[];VL=new Map;if(!J){g1.EY(7);break}return g.y(g1,trF(J,D,Z),8);case 8:P=g1.T;au=g.F(P);for(W=au.next();!W.done;W=au.next())e=W.value,VL.set(e,{videoId:e,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.y(g1,gp(C,{mode:"readonly",L4:!0},function(zt){return g.f3.all([nC(zt,"transfer"),nC(zt,"videoDownloadContextEntity")])}),9);
case 9:B=g1.T;v=g.F(B);w=v.next().value;C0=v.next().value;FG=w;Nc=C0;OS=g.F(FG);for(V8=OS.next();!V8.done;V8=OS.next())Tp=V8.value,Bv=g.tq(Tp.key).entityId,(u=VL.get(Bv))&&Tp&&(u.cotn=Tp.cotn);U=g.F(Nc);for(O=U.next();!O.done;O=U.next())b=O.value,x=g.tq(b.key).entityId,(pY=VL.get(x))&&b&&(pY.offlineModeType=b.offlineModeType);case 7:d1=[];Hv=g.F(q);for(k=Hv.next();!k.done;k=Hv.next())ES=k.value,my=g.tq(ES.key).entityId,i9=Jg(ES),my!==p&&i9.rootActionId!==p||tg(V,ES.actionProto)||d1.push(ES.key);kH=
g.cJ(p,"mainPlaylistEntity");return g.y(g1,gp(C,{mode:"readwrite",L4:!0},function(zt){var El=d1.map(function(zA){return wp(zt,zA)});
El.push(wp(zt,kH,{Yr:!0}));return g.f3.all(El)}),10);
case 10:if(!J){g1.EY(0);break}P.reverse();if(!P){g1.EY(0);break}hf=g.F(P);RF=hf.next();case 13:if(RF.done){g1.EY(0);break}cy=RF.value;return g.y(g1,K8(cy,C,V,N,VL.get(cy)),14);case 14:RF=hf.next(),g1.EY(13)}})},Mrc=function(p,C,V,N){var H,X,d,a,E,l,t,c,T;
return g.I(function(M){if(M.C==1)return H=g.cJ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),X=new Map,g.y(M,gp(p,{mode:"readwrite",L4:!0},function(J){var S=nC(J,"transfer"),D=nC(J,"offlineOrchestrationActionWrapperEntity"),Z=nC(J,"videoDownloadContextEntity"),f=RU(J,H,"mainDownloadsListEntity");return g.f3.all([S,D,Z,f]).then(function(q){q=g.F(q);var A=q.next().value;var z=q.next().value;var Q=q.next().value;var P=q.next().value;q=Tx0.map(function(au){return lo8(J,au)});
z=g.F(z);for(var VL=z.next();!VL.done;VL=z.next())VL=VL.value,tg(C,VL.actionProto)||q.push(wp(J,VL.key,{Yr:!0}));P&&(P.downloads=[],q.push(P9(J,P,"mainDownloadsListEntity")));if(Q)for(Q=g.F(Q),P=Q.next();!P.done;P=Q.next())P=P.value,z=g.tq(P.key).entityId,z=g.cJ(z,"transfer"),X.set(z,P.offlineModeType);return g.f3.all(q).then(function(){return A})})}),2);
d=M.T;a=g.F(d);for(E=a.next();!E.done;E=a.next())l=E.value,cK(l,X.get(l.key)),t=g.tq(l.key).entityId,c={videoId:t,offlineDeleteReason:N,cotn:l.cotn,offlineModeType:X.get(l.key)},Xh(c),T=g.cJ(t,"mainVideoEntity"),Nw(V,{entityKey:T,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.y(M,aA1(),0)})},lA0=function(p,C){var V=[];
if(p.thumbnailStyleData){p=g.F(p.thumbnailStyleData);for(var N=p.next();!N.done;N=p.next()){var H=void 0,X=void 0,d=void 0;V=V.concat(TY((H=N.value)==null?void 0:(X=H.value)==null?void 0:(d=X.collageThumbnail)==null?void 0:d.coverThumbnail))}}C=TY(C);return V.concat(C)},trF=function(p,C,V){var N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au;
return g.I(function(W){N=[];H=new Set;if(V.length)for(X=g.F(V),d=X.next();!d.done;d=X.next())if(a=d.value,E=void 0,(E=a.downloads)==null?0:E.length)for(l=g.F(a.downloads),t=l.next();!t.done;t=l.next())c=t.value,c.videoItem&&(T=g.tq(c.videoItem).entityId,H.add(T));if(p.videos){M=g.F(p.videos);for(J=M.next();!J.done;J=M.next())S=J.value,D=JSON.parse(g.tq(S).entityId),D.videoId&&!H.has(D.videoId)&&N.push(D.videoId);Z=g.F(C);for(f=Z.next();!f.done;f=Z.next())if(q=f.value,q.key!==p.key&&(A=q.videos))for(z=
g.F(A),Q=z.next();!Q.done;Q=z.next())P=Q.value,VL=JSON.parse(g.tq(P).entityId),VL.videoId&&(au=N.indexOf(VL.videoId),au!==-1&&N.splice(au,1))}return W.return(N)})},ECP=function(p,C){var V,N,H,X,d,a,E,l;
return g.I(function(t){V=TY(p.avatar);N=g.F(C);for(H=N.next();!H.done;H=N.next())if(X=H.value,X.id!==p.id)for(d=g.F(TY(X.avatar)),a=d.next();!a.done;a=d.next())E=a.value,l=V.indexOf(E),l!==-1&&V.splice(l,1);return t.return(V)})},JTP=function(p){var C;
return g.I(function(V){C=g.n(p.frameworkUpdates,D2);return p.frameworkUpdates&&C?g.y(V,Z21(C),0):V.return()})},vCr=function(p){var C;
if((C=p.onResponseReceivedActions)!=null&&C.length){var V;p=(V=g.n(g.n(p.onResponseReceivedActions[0],mZp),g.yB8))==null?void 0:V.actions;if(p!=null&&p.length)return p}},FO0=function(p){var C,V,N;
return g.I(function(H){if(H.C==1)return p?g.y(H,Qa(p,g.bS,"mainDownloadsListEntity"),2):H.return([]);C=H.T;return((V=C)==null?0:(N=V.downloads)==null?0:N.length)?H.return(C.downloads.map(function(X){var d;return(d=X.videoItem)!=null?d:""})):H.return([])})},KO5=function(p,C){var V;
return g.I(function(N){return N.C==1?g.y(N,SHc(p,C),2):(V=N.T)?g.y(N,gp(p,{mode:"readwrite",L4:!0},function(H){var X=[P9(H,V.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];V.mainDownloadsListEntity&&X.push(P9(H,V.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.f3.all(X)}),0):N.EY(0)})},SHc=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q;
return g.I(function(A){if(A.C==1)return V=g.cJ("main_downloads_library_id","mainDownloadsLibraryEntity"),N=g.cJ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.y(A,gp(p,{mode:"readonly",L4:!0},function(z){return g.f3.all([RU(z,V,"mainDownloadsLibraryEntity"),RU(z,N,"mainDownloadsListEntity")])}),2);
H=A.T;X=g.F(H);d=X.next().value;a=X.next().value;E=d;l=a;E||(E={id:V});t=g.F(C);for(c=t.next();!c.done;c=t.next())if(T=c.value,T===g.bS){if(E.smartDownloadsList)return A.return();E.smartDownloadsList=T}else if(M=g.tq(T).entityType,J={},M==="mainPlaylistEntity"?J.playlistItem=T:M==="mainVideoEntity"&&(J.videoItem=T),!g.k5(J)){S=void 0;if((S=l)==null?0:S.downloads){D=!1;Z=g.F(l.downloads);for(f=Z.next();!f.done;f=Z.next())if(q=f.value,q.playlistItem===T||q.videoItem===T){D=!0;break}D||l.downloads.push(J)}else l=
{id:N,downloads:[J]};E.downloadsList=N}return A.return({mainDownloadsLibraryEntity:E,mainDownloadsListEntity:l})})},DZF=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D;
return g.I(function(Z){if(Z.C==1)return V=g.cJ("main_downloads_library_id","mainDownloadsLibraryEntity"),N=g.cJ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.y(Z,gp(p,{mode:"readonly",L4:!0},function(f){return g.f3.all([RU(f,V,"mainDownloadsLibraryEntity"),RU(f,N,"mainDownloadsListEntity"),RU(f,g.bS,"mainDownloadsListEntity")])}),2);
H=Z.T;X=g.F(H);d=X.next().value;a=X.next().value;E=X.next().value;l=d;t=a;c=E;if(!l)return Z.EY(0);if(C===g.bS&&((T=c)==null?0:T.downloads))c.downloads=[];else if((M=t)==null?0:M.downloads)for(J=g.tq(C).entityType,S=0;S<t.downloads.length;S++)if(D=t.downloads[S],J==="mainVideoEntity"&&D.videoItem===C){t.downloads.splice(S,1);break}else if(J==="mainPlaylistEntity"&&D.playlistItem===C){t.downloads.splice(S,1);break}return g.y(Z,gp(p,{mode:"readwrite",L4:!0},function(f){var q=[P9(f,l,"mainDownloadsLibraryEntity")];
t&&q.push(P9(f,t,"mainDownloadsListEntity"));c&&q.push(P9(f,c,"mainDownloadsListEntity"));return g.f3.all(q)}),0)})},ul=function(p,C){var V,N,H,X,d,a,E,l,t,c,T;
return g.I(function(M){if(M.C==1)return V=g.cJ(C,"transfer"),N=g.cJ(C,"videoDownloadContextEntity"),g.y(M,gp(p,{mode:"readonly",L4:!0},function(J){return g.f3.all([RU(J,V,"transfer"),RU(J,N,"videoDownloadContextEntity")])}),2);
H=M.T;X=g.F(H);d=X.next().value;a=X.next().value;E=d;l=a;T={videoId:C,cotn:(t=E)==null?void 0:t.cotn,offlineModeType:(c=l)==null?void 0:c.offlineModeType};return M.return(T)})},Z2=function(p,C,V,N,H){var X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL;
return g.I(function(au){switch(au.C){case 1:return X=g.cJ(p,"musicTrack"),d=g.cJ(p,"transfer"),g.y(au,gp(C,{mode:"readonly",L4:!0},function(W){return g.f3.all([RU(W,X,"musicTrack"),RU(W,d,"transfer"),nC(W,"musicTrack"),nC(W,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:a=au.T;E=g.F(a);l=E.next().value;t=E.next().value;c=E.next().value;T=E.next().value;M=l;J=t;S=c;D=T;if(!M){au.EY(3);break}return g.y(au,uUc(M,S),4);case 4:return Z=au.T,g.y(au,Fh(Z),3);case 3:f=[];q=g.F(D);for(A=q.next();!A.done;A=q.next())z=A.value,Q=g.tq(z.key).entityId,P=Jg(z),VL=g.tq(P.action.entityKey).entityId,Q!==p&&VL!==p||tg(V,z.actionProto)||f.push(z.key);return g.y(au,gp(C,{mode:"readwrite",L4:!0},function(W){var e=f.map(function(B){return wp(W,B)});
e.push(wp(W,X,{Yr:!0}));return g.f3.all(e)}),6);
case 6:cK(J),H&&Xh(H),Nw(N,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.JQ(au)}})},Us=function(p,C,V,N,H){var X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc,OS,V8,Tp,Bv,u,U,O;
return g.I(function(b){switch(b.C){case 1:return X=g.cJ(p,C),d=g.cJ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(b,gp(V,{mode:"readonly",L4:!0},function(x){return g.f3.all([RU(x,X,C),RU(x,d,"musicDownloadsLibraryEntity"),nC(x,C),nC(x,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:a=b.T;E=g.F(a);l=E.next().value;t=E.next().value;c=E.next().value;T=E.next().value;M=l;J=t;S=c;D=T;if(!M){b.EY(3);break}return g.y(b,uUc(M,S),4);case 4:return Z=b.T,g.y(b,Fh(Z),3);case 3:f=[];q=new Map;if(!M){b.EY(6);break}return g.y(b,ZoG(M,S,J),7);case 7:f=b.T;A=g.F(f);for(z=A.next();!z.done;z=A.next())Q=z.value,P=g.tq(Q).entityId,q.set(P,{videoId:P,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.y(b,rp(V,"transfer"),8);case 8:for(VL=b.T,au=g.F(VL),
W=au.next();!W.done;W=au.next())e=W.value,B=g.tq(e.key).entityId,(v=q.get(B))&&e&&(v.cotn=e.cotn);case 6:w=[];C0=g.F(D);for(FG=C0.next();!FG.done;FG=C0.next())Nc=FG.value,OS=g.tq(Nc.key).entityId,V8=Jg(Nc),OS!==p&&V8.rootActionId!==p||tg(N,Nc.actionProto)||w.push(Nc.key);Tp=g.cJ(p,C);return g.y(b,gp(V,{mode:"readwrite",L4:!0},function(x){var pY=w.map(function(d1){return wp(x,d1)});
pY.push(wp(x,Tp,{Yr:!0}));return g.f3.all(pY)}),9);
case 9:if(!M){b.EY(0);break}f.reverse();if(!f.length){b.EY(0);break}Bv=g.F(f);u=Bv.next();case 12:if(u.done){b.EY(0);break}U=u.value;O=g.tq(U).entityId;if(!O){b.EY(13);break}return g.y(b,Z2(O,V,N,H,q.get(O)),13);case 13:u=Bv.next(),b.EY(12)}})},f8=function(p,C,V){var N,H,X,d,a,E,l;
return g.I(function(t){if(t.C==1)return g.y(t,gp(p,{mode:"readwrite",L4:!0},function(c){var T=nC(c,"transfer"),M=nC(c,"offlineOrchestrationActionWrapperEntity");return g.f3.all([T,M]).then(function(J){J=g.F(J);var S=J.next().value;var D=J.next().value;J=UZF.map(function(A){return lo8(c,A)});
D=g.F(D);for(var Z=D.next();!Z.done;Z=D.next()){Z=Z.value;var f=g.tq(Z.actionProto.entityKey).entityType==="musicTrack",q=Z.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";tg(C,Z.actionProto)||f&&(!f||q)||J.push(wp(c,Z.key,{Yr:!0}))}return g.f3.all(J).then(function(){return S})})}),2);
N=t.T;H=g.F(N);for(X=H.next();!X.done;X=H.next())d=X.value,cK(d),a=g.tq(d.key).entityId,E={videoId:a,offlineDeleteReason:void 0,cotn:d.cotn},Xh(E),l=g.cJ(a,"musicTrack"),Nw(V,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.y(t,aA1(),0)})},fA0=function(p){for(var C,V=g.F(p.additionalMetadatas),N=V.next();!N.done;N=V.next())N=N.value,N.offlineMusicVideoData&&(C=N.offlineMusicVideoData);
var H,X,d,a,E;return{id:g.cJ(p.videoId,"musicTrack"),videoId:p.videoId,title:p.title,thumbnailDetails:p.thumbnail,lengthMs:String(Number(p.lengthSeconds)*1E3),albumTitle:(H=C)==null?void 0:H.releaseTitle,musicVideoType:(X=C)==null?void 0:X.musicVideoType,contentRating:{explicitType:(d=C)==null?void 0:d.explicitType},artistNames:((a=C)==null?void 0:a.byline)||((E=C)==null?void 0:E.channelName),downloadMetadata:g.cJ(p.videoId,"musicTrackDownloadMetadataEntity")}},ZoG=function(p,C,V){var N,H,X,d,a,E,
l,t,c,T,M,J,S,D,Z,f,q,A;
return g.I(function(z){N=[];H=new Set;if((X=V)==null?0:(d=X.downloadedTracks)==null?0:d.length)for(a=g.F(V.downloadedTracks),E=a.next();!E.done;E=a.next())l=E.value,H.add(l);if(p.tracks){t=g.F(p.tracks);for(c=t.next();!c.done;c=t.next())T=c.value,H.has(T)||N.push(T);M=g.F(C);for(J=M.next();!J.done;J=M.next())if(S=J.value,S.id!==p.id&&(D=S.tracks))for(Z=g.F(D),f=Z.next();!f.done;f=Z.next())q=f.value,A=N.indexOf(q),A!==-1&&N.splice(A,1)}return z.return(N)})},uUc=function(p,C){var V,N,H,X,d,a,E,l;
return g.I(function(t){V=TY(p.thumbnailDetails);N=g.F(C);for(H=N.next();!H.done;H=N.next())if(X=H.value,X.id!==p.id)for(d=g.F(TY(X.thumbnailDetails)),a=d.next();!a.done;a=d.next())E=a.value,l=V.indexOf(E),l!==-1&&V.splice(l,1);return t.return(V)})},OoF=function(p,C){var V,N,H,X,d,a,E,l,t;
return g.I(function(c){if(c.C==1)return V=g.cJ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(c,Qa(p,V,"musicDownloadsLibraryEntity"),2);(N=c.T)||(N={id:V});H=g.tq(C).entityType;H==="musicTrack"?(X=N.downloadedTracks)!=null&&X.includes(C)||(N.downloadedTracks=((d=N.downloadedTracks)!=null?d:[]).concat(C)):H==="musicPlaylist"?(a=N.downloadedPlaylists)!=null&&a.includes(C)||(N.downloadedPlaylists=((E=N.downloadedPlaylists)!=null?E:[]).concat(C)):H!=="musicAlbumRelease"||(l=N.downloadedAlbumReleases)!=
null&&l.includes(C)||(N.downloadedAlbumReleases=((t=N.downloadedAlbumReleases)!=null?t:[]).concat(C));return g.y(c,W9(p,N,"musicDownloadsLibraryEntity"),0)})},yT2=function(p,C){var V,N,H,X,d,a,E;
return g.I(function(l){if(l.C==1)return V=g.cJ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.y(l,Qa(p,V,"musicDownloadsLibraryEntity"),2);N=l.T;if(!N)return l.EY(0);H=g.tq(C).entityType;H==="musicTrack"?X=N.downloadedTracks:H==="musicPlaylist"&&(X=N.downloadedPlaylists);if((d=X)==null?0:d.length)for(a=0;a<X.length;a++)if(E=X[a],E===C){X.splice(a,1);break}return g.y(l,W9(p,N,"musicDownloadsLibraryEntity"),0)})},qHv=function(p){var C=p.videos;
p=[];var V=[];if(C){C=g.F(C);for(var N=C.next();!N.done;N=C.next()){var H=N.value.offlineVideoData.videoId;N=g.cJ(H,"musicTrack");H=g.cJ(H,"musicTrackDownloadMetadataEntity");p.push(N);V.push(H)}}return{t1:p,BD:V}},Os=function(p,C,V){C={track:fA0(C)};
V&&(C.playlistId=V);if(p=g.n(p.actionMetadata,IAG))C.maximumDownloadQuality=p.maximumDownloadQuality;return{musicTrackEntityActionMetadata:C}},AT5=function(p){var C,V,N,H,X,d,a,E;
return g.I(function(l){switch(l.C){case 1:return C=g.KU(),V=Axy(p),N=g.On(boG),g.vv(l,2),X={xE:!0},g.y(l,g.E0(C,V,N,void 0,X),4);case 4:H=l.T;g.Fe(l,3);break;case 2:d=g.Sa(l);if(d instanceof g.vH)throw a="GetOffline network manager error: "+d.message,jx(a,d),Error(a);jx("GetOffline fetch request error",d);throw Error("GetOffline fetch request error");case 3:E=yZ(H);if(!H)throw jx("Network request failed"),Error("Network request failed");if(E!==void 0)qw(E);else if(!H.videos||!H.videos.length)throw jx("No data"),
Error("No data");return l.return(H.videos.map(function(t){return t.offlineVideoData}))}})},oC2=function(p){var C,V,N,H,X,d,a,E;
return g.I(function(l){switch(l.C){case 1:return C=g.KU(),V=ooP(p),N=g.On(boG),g.vv(l,2),X={xE:!0},g.y(l,g.E0(C,V,N,void 0,X),4);case 4:H=l.T;g.Fe(l,3);break;case 2:d=g.Sa(l);if(d instanceof g.vH)throw a="GetOffline network manager error for playlist: "+d.message,jx(a,d),Error(a);jx("GetOffline fetch request error for playlist",d);throw Error("GetOffline fetch request error for playlist");case 3:E=yZ(H);if(!H)throw jx("Network request failed for playlist"),Error("Network request failed for playlist");
if(E!==void 0)qw(E,"playlist");else if(!H.playlists||!H.playlists.length)throw jx("No data for playlist"),Error("No data for playlist");return l.return(H.playlists.map(function(t){return t.offlinePlaylistData}))}})},xZ8=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc;
return g.I(function(OS){switch(OS.C){case 1:return g.y(OS,B9(),2);case 2:H=OS.T;if(!H)return OS.return([]);X=[];if((d=N)==null?0:d.length){X=N;OS.EY(3);break}return g.y(OS,rp(H,"mainPlaylistEntity"),4);case 4:X=OS.T;case 3:if(!X.length)return OS.return([]);a=[];E=Date.now()/1E3;l=g.F(X);t=l.next();case 5:if(t.done)return a.length?g.y(OS,k21(a),10):OS.return([]);c=t.value;if(!c.downloadState){T=void 0;OS.EY(8);break}return g.y(OS,Qa(H,c.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:T=
OS.T;case 8:M=T;J=void 0;D=(S=(J=c)==null?void 0:J.entityMetadata)&&S.nextAutoRefreshIntervalSeconds?Number(S.nextAutoRefreshIntervalSeconds):NaN;Z=Number.isNaN(D)?p:D;q=f=void 0;A=((f=M)==null?0:f.lastSyncedTimestampMillis)?Number((q=M)==null?void 0:q.lastSyncedTimestampMillis)/1E3:0;Q=z=void 0;P=((z=M)==null?0:z.addedTimestampMillis)?Number((Q=M)==null?void 0:Q.addedTimestampMillis)/1E3:0;if(V||!S||A+Z<=E){VL=[];au=void 0;if((au=c.videos)==null?0:au.length)for(W=g.F(c.videos),e=W.next();!e.done;e=
W.next())B=e.value,v=JSON.parse(g.tq(B).entityId),v.videoId&&VL.push(v.videoId);w="0";S&&(C0=void 0,w=String(Number((C0=S.offlineLastModifiedTimestampSeconds)!=null?C0:0).toFixed()));FG={playlistId:c.playlistId,videoIds:VL,offlineLastModifiedTimestamp:w,autoSync:C,offlineDateAddedTimestamp:String(P.toFixed())};a.push(FG)}t=l.next();OS.EY(5);break;case 10:return Nc=OS.T,OS.return(Nc)}})},YHc=function(){var p,C,V,N,H;
return g.I(function(X){if(X.C==1)return g.y(X,B9(),2);if(X.C!=3)return(p=X.T)?g.y(X,rp(p,"refresh"),3):X.return(!1);C=X.T;if((V=C[0])==null||!V.refreshTime)return X.return(!1);N=Number(C[0].refreshTime);H=Date.now()/1E3;return X.return(isFinite(N)&&H>=N)})},Rz1=function(p,C){var V,N,H;
return g.I(function(X){switch(X.C){case 1:return g.vv(X,2),g.y(X,zzf(p,C),4);case 4:return N=X.T,g.y(X,JTP(N),5);case 5:V=vCr(N);g.Fe(X,3);break;case 2:H=g.Sa(X),jx("getAndProcessSmartDownloadsResponse request or processing error",H);case 3:return X.return(V)}})},nC1=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc;
return g.I(function(OS){switch(OS.C){case 1:return g.y(OS,B9(),2);case 2:H=OS.T;if(!H)return OS.return([]);X=[];if((d=N)==null?0:d.length){X=N;OS.EY(3);break}return g.y(OS,rp(H,"musicPlaylist"),4);case 4:X=OS.T;case 3:if(!X.length)return OS.return([]);a=[];E=Date.now()/1E3;l=g.F(X);t=l.next();case 5:if(t.done)return a.length?g.y(OS,k21(a),10):OS.return([]);c=t.value;T=void 0;J=(M=(T=c)==null?void 0:T.entityMetadata)&&M.nextAutoRefreshIntervalSeconds?Number(M.nextAutoRefreshIntervalSeconds):NaN;S=
Number.isNaN(J)?p:J;Z=D=0;f="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!c.downloadMetadata){OS.EY(8);break}return g.y(OS,Qa(H,c.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:q=OS.T,z=A=void 0,D=Number((z=(A=q)==null?void 0:A.addedTimestampMillis)!=null?z:"0")/1E3,P=Q=void 0,Z=Number((P=(Q=q)==null?void 0:Q.lastModifiedTimestampMillis)!=null?P:"0")/1E3,au=VL=void 0,f=(au=(VL=q)==null?void 0:VL.syncState)!=null?au:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:W=void 0;if(V||f!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!M||Number((W=M.lastSyncedTimestampSeconds)!=null?W:0)+S<=E){e=[];B=void 0;if((B=c.tracks)==null?0:B.length)for(v=g.F(c.tracks),w=v.next();!w.done;w=v.next())C0=w.value,e.push(g.tq(C0).entityId);FG={playlistId:c.playlistId,videoIds:e,offlineLastModifiedTimestamp:String(Z.toFixed()),autoSync:C,offlineDateAddedTimestamp:String(D.toFixed())};a.push(FG)}t=l.next();OS.EY(5);break;case 10:return Nc=OS.T,OS.return(Nc)}})},zzf=function(p,C){var V,N,H,X,d,a,E,l,t,c;
return g.I(function(T){switch(T.C){case 1:return V=g.KU(),g.y(T,B9(),2);case 2:N=T.T;if(!N){T.EY(3);break}return g.y(T,eUy(N),4);case 4:H=T.T;case 3:var M=H;X={context:g.Za(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:p},offlineClientState:M,clientStateRequestData:{preferredFormatType:C}}}};d=g.On(ez1);g.vv(T,5);E={xE:!0};return g.y(T,g.E0(V,X,d,void 0,E),7);case 7:a=T.T;g.Fe(T,6);break;case 5:l=g.Sa(T);if(l instanceof g.vH)throw t=
"DPS network manager error for smart downloads: "+l.message,jx(t,l),Error(t);jx("DPS fetch request error for smart downloads",l);throw Error("DPS fetch request error for smart downloads");case 6:c=yZ(a);if(a)c!==void 0&&qw(c,"smart downloads");else throw jx("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return T.return(a)}})},wpv=function(p,C){var V,N,H,X,d,a,E,l;
return g.I(function(t){switch(t.C){case 1:return V=g.KU(),N={context:g.Za(),videoPlaybackPositionEntities:p,lastSyncTimestampUsec:C},H=g.On(Pf2),g.vv(t,2),d={xE:!0},g.y(t,g.E0(V,N,H,void 0,d),4);case 4:X=t.T;g.Fe(t,3);break;case 2:a=g.Sa(t);if(a instanceof g.vH)throw E="VPPS network manager error: "+a.message,jx(E,a),Error(E);jx("VPPS fetch request error",a);throw Error("VPPS fetch request error");case 3:l=yZ(X);if(X)l!==void 0&&qw(l,"position sync");else throw jx("Network request failed for position sync"),
Error("Network request failed for position sync");return t.return(X)}})},LOy=function(p,C,V){var N,H,X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:N=g.KU();var T=V.refreshData,M=V.isEnqueuedForExpiredStreamUrlRefetch,J=V.Ir,S=V.offlineSourceData,D=V.mediaCapabilities,Z={entityKey:p};T&&(Z.refreshData=T);M&&(Z.isExpiredStreamUrlRefetch=M);J&&(Z.downloadParameters=J);S&&(Z.offlineSourceData=S);T={context:g.ck(C),signatureTimestamp:20073,videos:[Z]};D&&(T.mediaCapabilities=D);H=T;X=g.On($ZE);g.vv(c,2);a={xE:!0};return g.y(c,g.E0(N,H,X,void 0,a),4);case 4:d=c.T;g.Fe(c,3);break;case 2:E=g.Sa(c);if(E instanceof
g.vH)throw l="GetPDE network manager error: "+E.message,jx(l,E),Error(l);jx("GetPDE fetch request error",E);throw Error("GetPDE fetch request error");case 3:t=yZ(d);if(d)t!==void 0&&qw(t,"PDE");else throw jx("Network request failed for PDE"),Error("Network request failed for PDE");return c.return(d)}})},yZ=function(p){var C;
return(C=p.errorMetadata)==null?void 0:C.status},qw=function(p,C){C=C?" for "+C:"";
if(p===0)throw p="Empty response body"+C,jx(p),Error(p);p="Response with error"+C;jx(p);throw Error(p);},k21=function(p){var C,V,N,H,X,d,a,E;
return g.I(function(l){switch(l.C){case 1:return C=g.KU(),V=kuP(p),N=g.On(gCf),g.vv(l,2),X={xE:!0},g.y(l,g.E0(C,V,N,void 0,X),4);case 4:H=l.T;g.Fe(l,3);break;case 2:d=g.Sa(l);if(d instanceof g.vH)throw a="offlinePlaylistSyncCheck network manager error: "+d.message,jx(a,d),Error(a);jx("offlinePlaylistSyncCheck fetch request error",d);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:E=yZ(H);if(!H)throw jx("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(E!==void 0)qw(E,"playlist sync");else if(!H.offlinePlaylistSyncCheckDatas||!H.offlinePlaylistSyncCheckDatas.length)throw jx("No data for playlist sync"),Error("No data for playlist sync");return l.return(H.offlinePlaylistSyncCheckDatas.map(function(t){return t.offlinePlaylistSyncCheckData}))}})},Iz=function(p){this.T=p},WOE=function(p,C){var V,N,H,X,d,a;
return g.I(function(E){switch(E.C){case 1:V=new Map,N=g.F(C),H=N.next();case 2:if(H.done){E.EY(4);break}X=H.value;d=V;a=d.set;return g.y(E,p.C(X),5);case 5:a.call(d,X,E.T);H=N.next();E.EY(2);break;case 4:return E.return(V)}})},bl=function(p,C,V,N,H,X){C=g.cJ(C,V);
N=Object.assign({},X,{priority:N,retryScheduleIntervalsInSeconds:H});return{actionType:p,entityKey:C,actionMetadata:N}},Ag=function(p,C,V,N,H,X){this.status=p;
this.T=C;this.S=V;this.C=N;this.V=H;this.downloadState=X},Q11=function(p,C,V){this.T=p;
this.yn=C;this.V=V},G2v=function(p,C){var V,N,H,X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:return V=C.entityKey,H=(N=g.n(C.actionMetadata,oz))==null?void 0:N.isEnqueuedForExpiredStreamUrlRefetch,g.vv(c,2),X=void 0,g.y(c,rT8(p,C),4);case 4:X=c.T;g.vv(c,5);var T=(T=g.n(C.actionMetadata,oz))?{maximumDownloadQuality:T.maximumDownloadQuality}:void 0;return g.y(c,LOy(V,p.yn,{isEnqueuedForExpiredStreamUrlRefetch:H,Ir:T,offlineSourceData:X}),7);case 7:d=c.T;g.Fe(c,6,2);break;case 5:return g.Sa(c,2),a=il(C)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",jx("PDE handleAdd error"),c.return(kw(C,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",a,"DOWNLOAD_STATE_FAILED"));case 6:return g.y(c,Bxy(p,d,C),8);case 8:return c.return(kw(C,!0,d.orchestrationActions));case 2:return E=g.Sa(c),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.F2&&E.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jx("PDE handleAdd error"),c.return(kw(C,!1,void 0,l,t,"DOWNLOAD_STATE_FAILED"))}})},jq5=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au;
return g.I(function(W){switch(W.C){case 1:return V=C.entityKey,N=g.tq(V).entityId,g.y(W,gp(p.T,{mode:"readonly",L4:!0},function(e){var B=RU(e,V,"playbackData"),v=RU(e,g.cJ(N,"offlineVideoPolicy"),"offlineVideoPolicy");e=RU(e,g.cJ(N,"transfer"),"transfer");return g.f3.all([B,v,e])}),2);
case 2:H=W.T;X=g.F(H);d=X.next().value;a=X.next().value;E=X.next().value;l=d;t=a;c=E;if(!l||!t)return W.return(kw(C,!0));T=[];S=((J=l)==null?0:J.playerResponseJson)?JSON.parse(l.playerResponseJson):null;if(!(c&&S&&p.yn.G("html5_refresh_deprecated_downloads"))){W.EY(3);break}M=poc(p,S,c);return g.y(W,Cu1(p,c),4);case 4:T=W.T;case 3:D={lastPlayerResponseTimestampSeconds:l.playerResponseTimestamp,offlineToken:t.offlineToken,formatIds:T};Z={};if((f=c)==null?0:f.maximumDownloadQuality)Z.maximumDownloadQuality=
c.maximumDownloadQuality;g.vv(W,5);q=void 0;return g.y(W,rT8(p,C),7);case 7:return q=W.T,g.vv(W,8),g.y(W,LOy(V,p.yn,{refreshData:D,Ir:Z,offlineSourceData:q,mediaCapabilities:M}),10);case 10:A=W.T;g.Fe(W,9,5);break;case 8:return g.Sa(W,5),z=il(C)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",jx("PDE handleRefresh error"),W.return(kw(C,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",z,"DOWNLOAD_STATE_FAILED"));
case 9:return g.y(W,Bxy(p,A,C),11);case 11:return W.return(kw(C,!0,A.orchestrationActions));case 5:return Q=g.Sa(W),P="PDE handleRefresh error",Q instanceof Error&&(P="PDE handleRefresh error: "+Q.message),VL="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",au="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.F2&&Q.type==="QUOTA_EXCEEDED"&&(VL="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",au="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jx(P),W.return(kw(C,
!1,void 0,VL,au,"DOWNLOAD_STATE_FAILED"))}})},rT8=function(p,C){var V,N,H,X;
return g.I(function(d){if(d.C==1)return V=g.tq(C.entityKey).entityId,N=g.cJ(V,"videoDownloadContextEntity"),g.y(d,Qa(p.T,N,"videoDownloadContextEntity"),2);H=d.T;return(X=H)!=null&&X.offlineModeType?d.return({offlineModeType:H.offlineModeType}):d.return(void 0)})},Bxy=function(p,C,V){var N,H,X,d,a;
return g.I(function(E){if(E.C==1){if(!C.frameworkUpdates||!g.n(C.frameworkUpdates,D2))return E.return();if(!(g.n(C.frameworkUpdates,D2).mutations&&g.n(C.frameworkUpdates,D2).mutations.length>0&&g.n(C.frameworkUpdates,D2).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return E.EY(2);N=g.tq(g.n(C.frameworkUpdates,D2).mutations[0].entityKey).entityId;return g.y(E,ul(p.T,N),3)}if(E.C!=2){H=E.T;X=g.n(V.actionMetadata,oz);if(a=(d=X)==null?void 0:d.playlistId)H.playlistId=a;H.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.wG(p.yn)?g.y(E,K8(N,p.T,V,p.V,H),2):g.gk(p.yn)?g.y(E,Z2(N,p.T,V,p.V),2):E.EY(2)}return g.y(E,Z21(g.n(C.frameworkUpdates,D2)),0)})},kw=function(p,C,V,N,H,X){return new Ag(C?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",il(p),V,N,H,X)},poc=function(p,C,V){C=hz8(p.yn,V.cotn,C);
V=g.aM(C);return g.NGS(C,V,p.yn)},Cu1=function(p,C){var V,N,H,X,d,a,E,l,t,c,T;
return g.I(function(M){if(M.C==1)return V=[],g.y(M,gp(p.T,{mode:"readonly",L4:!0},function(J){var S=[],D=C.offlineVideoStreams;if(D){D=g.F(D);for(var Z=D.next();!Z.done;Z=D.next())S.push(RU(J,Z.value,"offlineVideoStreams"))}return g.f3.all(S)}),2);
if(N=M.T)for(H=g.F(N),X=H.next();!X.done;X=H.next())if(d=X.value,a=void 0,(a=d)==null?0:a.streamsProgress)for(E=d.streamsProgress,l=0;l<E.length;l++)t=E[l],c=JSON.parse(t.formatStreamBytes),T={itag:c.itag,lmt:c.lastModified,xtags:c.xtags},V.push(T);return M.return(V)})},V0y=function(p,C){this.T=p;
this.yn=C},NEY=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M;
return g.I(function(J){switch(J.C){case 1:return V=il(C),g.y(J,rp(p.T,"videoPlaybackPositionEntity"),2);case 2:N=J.T;if(N.length===0)return J.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(J,3);return g.y(J,x8.getInstance(),5);case 5:H=J.T;if(!H)throw Error("prefStorage is undefined");return g.y(J,H.get("psi"),6);case 6:return X=J.T,E=(a=(d=X)==null?void 0:d.YC)!=null?a:"0",g.y(J,wpv(N,E),7);case 7:return l=J.T,t={isPaused:l.watchHistoryPaused,YC:l.syncTimestampUsec},g.y(J,H.set("psi",
t),8);case 8:if(t.isPaused){J.EY(9);break}c=g.n(l.frameworkUpdates,D2);if(!l.frameworkUpdates||!c){J.EY(9);break}return g.y(J,Z21(c),9);case 9:g.Fe(J,4);break;case 3:return T=g.Sa(J),M="PPE handleRefresh error: "+(T instanceof Error?T.message:"unknown error"),jx(M),J.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return J.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},Xop=function(p,C){var V,N,H,X,d,a,E,l;
return g.I(function(t){switch(t.C){case 1:return V=il(C),N=g.tq(C.entityKey).entityId,g.vv(t,2),g.y(t,x8.getInstance(),4);case 4:H=t.T;if(!H)throw Error("prefStorage is undefined");return g.y(t,H.get("psi"),5);case 5:X=t.T;d=g.n(C.actionMetadata,HX2);if(((a=X)==null?void 0:a.isPaused)!==!1||(E=d)==null||!E.lastPlaybackPositionSeconds){t.EY(6);break}l={key:g.cJ(N,"videoPlaybackPositionEntity"),videoId:N,lastPlaybackPositionSeconds:d.lastPlaybackPositionSeconds};return g.y(t,W9(p.T,l,"videoPlaybackPositionEntity"),
6);case 6:g.Fe(t,3);break;case 2:return g.Sa(t),t.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},dPP=function(p,C){var V,N,H;
return g.I(function(X){switch(X.C){case 1:V=il(C);g.vv(X,2);N=g.tq(C.entityKey).entityId;if(N==="!*$_ALL_ENTITIES_!*$")return g.y(X,FGP(p.T),5);H=g.cJ(N,"videoPlaybackPositionEntity");return g.y(X,vo8(p.T,H),5);case 5:g.Fe(X,3);break;case 2:return g.Sa(X),X.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},iXr=function(p,C){this.api=p;
this.T=C;this.logger=new g.HI("woffle");this.C=!1;this.Sr={Cy:this.Cy};this.logger.debug("Initialized OfflineMediaManager")},hF8=function(p){return g.I(function(C){return C.return(b2f(p))})},sqy=function(p){var C;
return g.I(function(V){if(V.C==1)return g.y(V,g.CtL(p),2);C=V.T;return V.return(C.filter(function(N){return!!N.url}).map(function(N){return N.url}))})},xw=function(p,C){var V=g.Db(C);
if(V===1||V===0)return Promise.resolve();(V=aKy(p,C))&&V.stopVideo();p.V=0;return hF8(C)},Yw=function(p,C,V,N){V=V===void 0?!1:V;
N=N===void 0?!0:N;var H=typeof C==="string"?C:C.videoDetails.videoId;g.Db(H)===2&&((C=aKy(p,H))?C.stopVideo():p.logger.info(function(){return"Corresponding player for "+H+" not found. Pausing anyway"}),g.us(H,2),p.V=2,V?EI1(p.T):N&&lKY(p.T))},aKy=function(p,C){var V;
return((V=p.player)==null?void 0:V.getVideoData().videoId)===C?p.player:null},t0r=function(p,C,V){C.getPlayerResponse();
g.us(C.videoId,2);p.V=2;p.C=!1;var N;(N=p.player)==null||N.dispose();p.player=p.api.WW(9,C);C={};g.TB(p.player,(C.localmediachange=p.yG,C.signatureexpired=p.By,C.statechange=p.Jk$,C),p);var H=p.Cy(V);g.rrv(p.player,g.jo(H,H,!0,"m"),!1);p.logger.debug(function(){return"Starting headless playback with quality: "+H});
g.vO(p.player,!1)},cCr=function(p,C){this.T=p;
this.yn=C},M0v=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.y(H,Qa(p.T,C.entityKey,"transfer"),2);case 2:if(N=H.T)return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(H,3);return g.y(H,TE2(p,C),5);case 5:g.Fe(H,4);break;case 3:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},JCG=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.y(H,Qa(p.T,C.entityKey,"transfer"),2);case 2:N=H.T;if(!N||N.transferState!=="TRANSFER_STATE_COMPLETE")return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(H,3);return g.y(H,TE2(p,C,!0),5);case 5:g.Fe(H,4);break;case 3:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},mP2=function(p,C){var V,N,H,X,d,a,E,l,t,c;
return g.I(function(T){switch(T.C){case 1:return V=il(C),N=g.tq(C.entityKey).entityId,g.y(T,gp(p.T,{mode:"readonly",L4:!0},function(M){var J=RU(M,C.entityKey,"transfer");M=RU(M,g.cJ(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.f3.all([J,M])}),2);
case 2:H=T.T;X=g.F(H);d=X.next().value;a=X.next().value;E=d;l=a;if(!E||E.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(T,3);E.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.y(T,W9(p.T,E,"transfer"),5);case 5:t=g.tq(E.key).entityId;dQ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:t,NB:E,offlineModeType:(c=l)==null?void 0:c.offlineModeType});g.Fe(T,
4);break;case 3:return g.Sa(T),T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},TE2=function(p,C,V){V=V===void 0?!1:V;
var N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z;return g.I(function(f){switch(f.C){case 1:return N=g.n(C.actionMetadata,vIp),H=g.tq(C.entityKey).entityId,X=g.cJ(H,"downloadStatusEntity"),g.y(f,gp(p.T,{mode:"readonly",L4:!0},function(q){var A=RU(q,X,"downloadStatusEntity");q=RU(q,g.cJ(H,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.f3.all([A,q])}),2);
case 2:return d=f.T,a=g.F(d),E=a.next().value,l=a.next().value,t=E,c=l,T="TRANSFER_STATE_TRANSFER_IN_QUEUE",((M=t)==null?void 0:M.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(T="TRANSFER_STATE_PAUSED_BY_USER"),D={key:C.entityKey,transferState:T,cotn:g.OI(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(J=N)==null?void 0:J.maximumDownloadQuality,preferredAudioTrack:(S=N)==null?void 0:S.preferredAudioTrack,transferRetryCount:0,isRefresh:V,hasLoggedFirstStarted:!1},g.y(f,gp(p.T,
{mode:"readwrite",L4:!0},function(q){var A=[];V&&A.push(wp(q,g.cJ(H,"offlineVideoStreams")));A.push(P9(q,D,"transfer"));return g.f3.all(A)}),3);
case 3:if(!V){f.EY(4);break}return g.y(f,hF8(H),4);case 4:dQ({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:H,NB:D,offlineModeType:(Z=c)==null?void 0:Z.offlineModeType}),g.JQ(f)}})},SMr=function(p,C,V,N){if(!p.action.entityKey)throw Error("entityKey is missing.");
var H=g.tq(p.action.entityKey);H={entityType:H.aD,entityId:H.entityId,offlineOrchestrationActionType:p.action.actionType,orchestrationAction:{orchestrationActionId:p.actionId}};C&&(H.offlineOrchestrationActionResult=C.status,H.isRetryable=V?!1:C.T,C.V&&(H.offlineOrchestrationFailureReason=FVy(C.V,H.isRetryable)));var X,d;if((X=p.action.actionMetadata)==null?0:(d=X.offlineLoggingData)==null?0:d.offlineModeType)H.offlineModeType=p.action.actionMetadata.offlineLoggingData.offlineModeType;N&&(H.additionalOrchestrationActions=
N.map(function(a){return{orchestrationActionId:a.actionId}}));
return H},FVy=function(p,C){return p!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||C?p==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&C?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":p:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},KV8=function(p,C){var V={offlineOrchestrationContext:SMr(p)};
C=RUf(C,V);noY(zUG(),C,p.rootActionId)},DPv=function(p,C,V,N){N=N===void 0?[]:N;
C={offlineOrchestrationContext:SMr(p,C,V,N)};C=RUf(3,C);noY(zUG(),C,p.rootActionId)},ulF=function(){this.actions=[]},ZXG=function(p,C){C=g.F(C);
for(var V=C.next();!V.done;V=C.next())V=V.value,KV8(V,1),p.actions.push(V);p.actions.sort(p.T)},UP5=function(p,C){if(C)for(var V=0;V<p.actions.length;V++)if(C==="!*$_ALL_ENTITIES_!*$"&&p.actions[V].actionId!==C||C!=="!*$_ALL_ENTITIES_!*$"&&p.actions[V].rootActionId===C&&p.actions[V].actionId!==C)p.actions.splice(V,1),V--},fKc=function(p,C){p=g.F(p.actions);
for(var V=p.next();!V.done;V=p.next())if(V.value.actionId===C)return!0;return!1},zY=function(p,C,V,N,H){g.Y.call(this);
var X=this;this.C=p;this.sY=C;this.a$=V;this.D=N;this.yn=H;this.T=new ulF;this.Y=new g.Hl;this.V=new g.N8(function(){X.retry()});
this.J=NaN;this.W=!1;this.Sr={AFr:function(){return X.T},
J4:function(){return X.Y},
V6V:function(){return X.V},
retry:function(){return X.retry()}};
g.R(this,this.V);this.Z=this.C.observe(this.b_.bind(this))},qME=function(p,C,V,N,H){var X;
return g.I(function(d){if(d.C==1)return X=new zY(p,C,V,N,H),g.y(d,OX2(X),2);yCG(X);return d.return(X)})},yCG=function(p){var C=p.T.actions[0];
return p.S?((C==null?void 0:C.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&p.S[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(p.W=!0),Promise.resolve()):IK2(p)},IK2=function(p){var C,V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z;
return g.I(function(f){switch(f.C){case 1:if(p.S)throw Error("Already processing an action");if(p.fS())return f.return();C=p.T.actions.shift();Cfv(p.a$,!C);if(C===void 0)return f.return();C.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&C.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&UP5(p.T,C.actionId);V="";C.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&C.rootActionId===C.actionId&&(V=C.actionId);N=[C];p.S=N;if(H=p.sY[C.entityType]){f.EY(2);break}p.S=
void 0;return g.y(f,IK2(p),3);case 3:return f.return();case 2:X=g.F(N);for(d=X.next();!d.done;d=X.next())a=d.value,KV8(a,2);g.vv(f,4,5);return g.y(f,WOE(H,N.map(function(q){return q.action})),7);
case 7:E=f.T,l=g.F(N),t=l.next();case 8:if(t.done){f.EY(10);break}c=t.value;T=E.get(c.action);return g.y(f,bX0(p,c,T),9);case 9:t=l.next();f.EY(8);break;case 10:UP5(p.T,V);case 5:g.KY(f);p.S=void 0;g.Dj(f,6);break;case 4:return M=g.Sa(f),jx("Orchestration error",M),g.vv(f,12),g.y(f,ACy(p,N),14);case 14:g.Fe(f,5);break;case 12:J=g.Sa(f);jx("Orchestration retry error",J);S=g.F(N);for(D=S.next();!D.done;D=S.next())Z=D.value,Z.retryScheduleIndex<3&&ZXG(p.T,[Z]);f.EY(5);break;case 6:return g.y(f,IK2(p),
0)}})},bX0=function(p,C,V){var N,H,X,d,a,E,l,t,c,T,M,J;
return g.I(function(S){switch(S.C){case 1:N=C.retryScheduleIndex+2===3;if(V.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){S.EY(2);break}if(V.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){S.EY(0);break}DPv(C,V,N);if(V.T&&C.retryScheduleIndex+1<3)return g.y(S,ACy(p,[C]),0);X=((H=V)==null?0:H.C)?V.C:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";d={entityKey:C.action.entityKey,failureReason:X};a=void 0;g.wG(p.yn)?a="mainVideoDownloadStateEntity":g.gk(p.yn)&&(a="musicTrackDownloadMetadataEntity");
if(!a||!V.downloadState){S.EY(7);break}E=g.tq(C.action.entityKey).entityId;return g.y(S,ll(E,a,p.C,V.downloadState),7);case 7:Nw(p.D,d);if(V.downloadState==="DOWNLOAD_STATE_FAILED"&&p.yn.G("html5_auto_retry_failed_pde_actions")){S.EY(0);break}jx("Orchestration result is not retryable, deleting action");return g.y(S,vo8(p.C,vK(C).key),0);case 2:l=void 0;try{l=(t=V.S)==null?void 0:t.map(function(D){return p.createAction(D,C)})}catch(D){return DPv(C,V,N),c={entityKey:C.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Nw(p.D,c),jx("Orchestration subactions creation error",D),S.return()}DPv(C,V,N,l);if(!l){S.EY(12);break}T=l.map(function(D){return vK(D)});
M=0;case 13:if(!(M<l.length)||p.W){S.EY(15);break}return g.y(S,gp(p.C,{mode:"readwrite",L4:!0},function(D){var Z=[];Z.push(s9F(D,T.slice(M,M+10),"offlineOrchestrationActionWrapperEntity"));return g.f3.all(Z)}),16);
case 16:M+=10;S.EY(13);break;case 15:if(p.W)return p.W=!1,S.return();case 12:return J=vK(C),g.y(S,vo8(p.C,J.key),17);case 17:KV8(C,4),g.JQ(S)}})},YMP=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M;
return g.I(function(J){V=[];N=Infinity;H=4E3;X=g.F(C);for(d=X.next();!d.done;d=X.next())a=d.value,E=Number(a.enqueueTimeSec),l=oIP(E),t=a.retryScheduleIndex,c=t!=null&&t>0,l>0&&c?(N=Math.min(N,E),H=Math.min(l,H)):V.push(a);isFinite(N)&&(!p.V.isActive()||N<p.J)&&(p.J=N,p.V.start(H));p.Y.nO()||(T=V.length,V=V.filter(function(S){var D;S=((D=S.actionProto)==null?void 0:D.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!koY.includes(S)}),M=V.length<T,!p.V.isActive()&&M&&p.V.start(1));
V.length>0&&xP2(p,V);return g.y(J,yCG(p),0)})},RFE=function(p){var C,V,N,H,X,d,a;
return g.I(function(E){if(E.C==1)return g.y(E,zFf(p),2);C=E.T;V=[];N=g.F(C);for(H=N.next();!H.done;H=N.next())X=H.value,d=g.tq(X.key),a=d.entityId,fKc(p.T,a)||V.push(X);return g.y(E,YMP(p,V),0)})},oIP=function(p){p=p*1E3-Date.now();
return p>4E3?4E3:p},ACy=function(p,C){var V,N,H;
return g.I(function(X){V=g.F(C);for(N=V.next();!N.done;N=V.next()){H=N.value;var d=void 0,a=void 0,E=((a=H.action)==null?void 0:(d=a.actionMetadata)==null?void 0:d.retryScheduleIntervalsInSeconds)||[1,2,4];d=1;H.retryScheduleIndex<E.length&&(d=E[H.retryScheduleIndex]);H.T=d*1E3+Date.now();H.retryScheduleIndex++}return g.y(X,nIy(p,C),0)})},OX2=function(p){var C;
return g.I(function(V){if(V.C==1)return g.y(V,rp(p.C,"offlineOrchestrationActionWrapperEntity"),2);C=V.T;return g.y(V,YMP(p,C),0)})},xP2=function(p,C){C.length!==0&&C.forEach(function(V){V=Jg(V);
V.retryScheduleIndex<3&&ZXG(p.T,[V])})},zFf=function(p,C){var V;
return g.I(function(N){if(N.C==1)return g.y(N,rp(p.C,"offlineOrchestrationActionWrapperEntity",C),2);V=N.T;return N.return(V.filter(UKP))})},nIy=function(p,C){if(C.length===0)return Promise.resolve([]);
C=C.map(function(V){return vK(V)});
return mKE(p.C,C)},eFy=function(p){this.ea=p;
this.T=void 0},PuF=function(p,C){var V,N,H,X;
return g.I(function(d){V=C.videoId;N=!0;if(C.captionTracks.length)H=aq2(C),p.T=new g.oT(p.ea,C,H);else if(C.iW)X=g.vgS(C),p.T=new g.xW(p.ea,C.iW,V,X,C.lF,C.eventId),N=C.lF;else return d.return();return d.return(new Promise(function(a){var E;(E=p.T)==null||E.Jr({m$:function(){return g.I(function(l){if(l.C==1)return g.y(l,p.m$(V,N),2);a();g.JQ(l)})},
b3:function(){}})}))})},woY=function(p){var C;
return g.I(function(V){if(V.C==1)return g.y(V,Iop(p),2);C=V.T;return V.return(!!C&&C.length>0)})},Rz=function(p){g.Y.call(this);
this.T=p;this.C=this.T.observe(this.V.bind(this))},$PY=function(p,C){var V,N,H,X,d,a,E;
return g.I(function(l){switch(l.C){case 1:if(C.length===0)return l.return([]);V=C.map(function(t){return g.cJ(t,"transfer")});
return g.y(l,rp(p.T,"transfer",V),2);case 2:N=l.T;H=N.filter(UKP).map(function(t){return g.tq(t.key).entityId});
X=C.filter(function(t){return H.indexOf(t)===-1});
if(X.length===0)return l.return([]);d=g.F(X);a=d.next();case 3:if(a.done){l.EY(5);break}E=a.value;return g.y(l,hF8(E),4);case 4:a=d.next();l.EY(3);break;case 5:return l.return(X)}})},WVY=function(p,C,V,N,H,X){var d,a,E;
return g.I(function(l){d="STREAM_TYPE_UNKNOWN";V.video&&V.audio?(d="STREAM_TYPE_AUDIO_AND_VIDEO",jx("unexpected stream type")):V.video&&!V.audio?d="STREAM_TYPE_VIDEO":!V.video&&V.audio&&(d="STREAM_TYPE_AUDIO");a=g.cJ(C,"offlineVideoStreams");E={numBytesDownloaded:H.toFixed(),numTotalBytes:X.toFixed(),streamType:d,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(N),itag:d==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(V.itag):void 0};return g.y(l,gp(p,{mode:"readwrite",L4:!0},
function(t){var c=RU(t,a,"offlineVideoStreams"),T=RU(t,g.cJ(C,"transfer"),"transfer");return g.f3.all([c,T]).then(function(M){M=g.F(M);var J=M.next().value;M=M.next().value;if(!M)return wp(t,a).then(function(){});
var S=LVG(J);J=gI2(J,N,E,a);var D=P9(t,J,"offlineVideoStreams");LVG(J)>S&&(M.lastProgressTimeMs=Date.now().toString());S=[D];M.offlineVideoStreams||(M.offlineVideoStreams=[]);M.offlineVideoStreams.indexOf(a)===-1&&(M.offlineVideoStreams.push(a),S.push(P9(t,M,"transfer")));return g.f3.all(S)})}),0)})},QqE=function(p,C){var V,N,H,X,d;
return g.I(function(a){if(a.C==1)return V=g.cJ(C,"offlineVideoStreams"),g.y(a,Qa(p,V,"offlineVideoStreams"),2);N=a.T;if(!N||!N.streamsProgress)return a.return();H=g.F(N.streamsProgress);for(X=H.next();!X.done;X=H.next())d=X.value,d.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",d.numTotalBytes!==d.numBytesDownloaded&&(d.numBytesDownloaded=d.numTotalBytes);return g.y(a,W9(p,N,"offlineVideoStreams"),0)})},gI2=function(p,C,V,N){if(p&&p.streamsProgress){N=p;
a:{C=C.itag+";"+C.xtags;for(var H=p.streamsProgress,X=0;X<H.length;X++){var d=JSON.parse(H[X].formatStreamBytes);if(d.itag+";"+d.xtags===C){H[X]=V;V=H;break a}}H.push(V);V=H}N.streamsProgress=V}else p={key:N,streamsProgress:[V]};return p},LVG=function(p){if(p==null?0:p.streamsProgress){var C=0;
p=p.streamsProgress;for(var V=0;V<p.length;V++){var N=p[V];isNaN(Number(N.numBytesDownloaded))?jx("stream progress bytes number invalid"):C+=Number(N.numBytesDownloaded)}return C}return 0},rCr=function(p,C,V,N){g.Y.call(this);
var H=this;this.C=p;this.api=C;this.Y_=V;this.b_=N;this.Y=new g.Hl;this.S=new g.N8(function(){H.T&&H.T.transferState==="TRANSFER_STATE_TRANSFERRING"&&H.Y.nO()&&((H.T.transferRetryCount||0)<3?Yw(H.D,H.W,!1,!1):xw(H.D,H.W.videoDetails.videoId),H.vn("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.a$=this.Sa=0;this.Z=this.J=!1;this.R$=g.mi(this.api.K().experiments,"html5_transfer_processing_logs_interval");this.Ga=new g.Rr(this);this.Sr={v$$:function(){return H.S},
ZeY:function(){return H.b_},
J4:function(){return H.Y}};
this.sY=this.C.observe(this.H7.bind(this));this.D=new iXr(C,this);this.UY=new eFy(C);this.Vn=new Rz(this.C);this.vr=this.Y.listen("publicytnetworkstatus-online",this.Ey.bind(this));this.Wr=this.Y.listen("publicytnetworkstatus-offline",this.qZS.bind(this));this.Z=this.api.K().G("html5_less_transfer_processing_logs");g.R(this,this.Ga);this.Ga.U(C,"offlinetransferpause",this.ccr);g.wG(this.api.K())?this.V="mainVideoDownloadStateEntity":g.gk(this.api.K())&&(this.V="musicTrackDownloadMetadataEntity")},
BEp=function(p){return g.I(function(C){if(C.C==1)C=g.y(C,yxG(),2);
else{var V=p.Vn;var N=g.Kk();N=Object.keys(N);V=$PY(V,N);C=g.y(C,V,0)}return C})},ex=function(p,C){C=C===void 0?!1:C;
var V;return g.I(function(N){if(N.C==1){if(p.T)throw Error("Already downloading a video");p.a$=0;p.J=!1;return g.y(N,GoE(p),2)}return N.C!=4?(V=N.T,j1f(p.Y_,!V),V&&p.Y.nO()?C?g.y(N,new Promise(function(H){g.F5(H,1E3)}),4):N.EY(4):(!V&&p.T&&n8(p),N.EY(0))):g.y(N,pFf(p,V),0)})},CI5=function(p){return g.I(function(C){if(C.C==1)return p.W?g.y(C,xw(p.D,p.W.videoDetails.videoId),3):C.EY(0);
n8(p);g.JQ(C)})},jL8=function(p,C){var V,N,H;
return g.I(function(X){switch(X.C){case 1:return g.vv(X,2),(V=!!C.captionTracks.length||!!C.iW)?g.y(X,woY(C.videoId),4):X.return();case 4:return(N=X.T)?X.return():g.y(X,PuF(p.UY,C),5);case 5:g.Fe(X,0);break;case 2:H=g.Sa(X),jx("Caption downloading error",H,C.cotn),g.JQ(X)}})},pFf=function(p,C){var V,N,H,X,d,a;
return g.I(function(E){switch(E.C){case 1:if(p.J)return E.return();p.J=!0;p.T=C;V=g.tq(p.T.key);N=V.entityId;H=void 0;if(p.T.transferState==="TRANSFER_STATE_TRANSFERRING")return g.y(E,PK(p,N),7);if(p.T.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||p.T.transferRetryCount||p.T.hasLoggedFirstStarted){E.EY(3);break}return g.y(E,PK(p,N),5);case 5:return H=E.T,p.T.hasLoggedFirstStarted=!0,g.y(E,VJc(p),6);case 6:Vrr({videoId:N,NB:p.T,offlineModeType:H},void 0,void 0,!0);E.EY(3);break;case 7:H=E.T,
dQ({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:N,NB:p.T,offlineModeType:H});case 3:return g.y(E,N0r(p),8);case 8:return X=null,g.vv(E,9),g.y(E,Hg5(p,C),11);case 11:X=E.T;p.W=X;g.Fe(E,10);break;case 9:return d=g.Sa(E),jx("error getting player response",d,C.cotn),g.y(E,p.vn("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return E.return();case 10:return a=hz8(p.api.K(),C.cotn,X),g.y(E,jL8(p,a),13);case 13:return g.y(E,sqy(a.videoId),
14);case 14:a.Ot=E.T,t0r(p.D,a,C.maximumDownloadQuality),p.S.start(108E5),g.JQ(E)}})},GoE=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,rp(p.C,"transfer"),2);C=N.T;V=C.filter(XF0).sort(d8f);return V.length===0?N.return():N.return(V[0])})},N0r=function(p){var C,V,N;
return g.I(function(H){if(H.C==1){if(!p.T)return wQ(p,"onTransferStart"),H.return();p.S.start(108E5);return g.y(H,$w(p,"TRANSFER_STATE_TRANSFERRING"),2)}C=p.T;return(N=((V=C)==null?0:V.key)?g.tq(C.key).entityId:"")&&p.V?g.y(H,ll(N,p.V,p.C,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):H.EY(0)})},EI1=function(p){var C,V,N,H;
g.I(function(X){switch(X.C){case 1:if(!p.T){wQ(p,"onTransferPausedByUser");X.EY(2);break}C=p.T;p.S.stop();return g.y(X,$w(p,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:N=((V=C)==null?0:V.key)?g.tq(C.key).entityId:"";if(!N||!p.V){X.EY(4);break}return g.y(X,ll(N,p.V,p.C,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.y(X,PK(p,N),6);case 6:H=X.T,NxP({videoId:N,NB:C,offlineModeType:H});case 2:n8(p),ex(p),g.JQ(X)}})},lKY=function(p){var C,V,N;
g.I(function(H){if(H.C==1){if(!p.T)return wQ(p,"onTransferPausedByNetwork"),H.return();p.S.stop();return g.y(H,$w(p,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(H.C!=3)return C=p.T,(N=((V=C)==null?0:V.key)?g.tq(C.key).entityId:"")&&p.V?g.y(H,ll(N,p.V,p.C,"DOWNLOAD_STATE_PAUSED"),3):H.EY(3);n8(p);g.JQ(H)})},ig0=function(p){var C,V,N,H,X;
g.I(function(d){switch(d.C){case 1:if(!p.T)return wQ(p,"onTransferComplete"),d.return();C=p.T;p.S.stop();if(!C||!p.W){d.EY(2);break}V=hz8(p.api.K(),C.cotn,p.W);return g.y(d,jL8(p,V),2);case 2:return g.y(d,$w(p,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:H=((N=C)==null?0:N.key)?g.tq(C.key).entityId:"";if(!H||!p.V){d.EY(5);break}return g.y(d,ll(H,p.V,p.C,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.y(d,QqE(p.C,H),7);case 7:return g.y(d,PK(p,H),8);case 8:X=d.T,dQ({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:H,NB:C,offlineModeType:X}),n8(p),ex(p),g.JQ(d)}})},hop=function(p,C,V){var N,H;
g.I(function(X){switch(X.C){case 1:if(!p.T)return wQ(p,"onTransferProgress: "+C),X.return();if(p.T.transferState==="TRANSFER_STATE_TRANSFERRING"){X.EY(2);break}return g.y(X,N0r(p),2);case 2:N=Date.now();if(!(N-p.Sa>1E3)){X.EY(4);break}p.Sa=N;return g.y(X,WVY(p.C,V.videoId,V.C,V.Qq,V.bytesDownloaded,V.T),5);case 5:if(p.Z&&!(p.Z&&N-p.a$>p.R$)){X.EY(4);break}p.a$=N;return g.y(X,PK(p,C),7);case 7:H=X.T,Vrr({videoId:C,NB:p.T,offlineModeType:H},V.bytesDownloaded,V.T);case 4:p.S.start(108E5),g.JQ(X)}})},
sLp=function(p){var C=(p.T.transferRetryCount||0)<3;
C&&(p=p.T,p.transferRetryCount=(p.transferRetryCount||0)+1);return C},aJ1=function(p,C){C=C===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":C;
var V,N,H,X;return g.I(function(d){if(d.C==1)return p.T||wQ(p,"setTransferToFailed: "+C),V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C==="TRANSFER_FAILURE_REASON_NETWORK"?V="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":C==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.y(d,$w(p,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",C),2);if(d.C!=3)return Nw(p.b_,{entityKey:(N=p.T)==null?void 0:N.key,failureReason:V}),
H=p.T?g.tq(p.T.key).entityId:"",g.y(d,PK(p,H),3);X=d.T;var a={videoId:H,NB:p.T,offlineModeType:X},E=C,l={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};E&&(l.transferFailureReason=E,l.failureReason=Hor(E));dQ(l,a);g.JQ(d)})},$w=function(p,C,V,N){var H;
return g.I(function(X){if(X.C==1){if(!p.T)return wQ(p,"saveTransferState: "+C),X.return();p.T.transferState=C;p.T.failureReason=N;g.vv(X,2);return g.y(X,VJc(p,function(d){return V?nC(d,"offlineVideoStreams",p.T.offlineVideoStreams).then(function(a){for(var E=g.F(a),l=E.next();!l.done;l=E.next())if((l=l.value)&&l.streamsProgress){l=g.F(l.streamsProgress);for(var t=l.next();!t.done;t=l.next())t.value.streamState=V}return s9F(d,a.filter(function(c){return!!c}),"offlineVideoStreams")}):g.f3.resolve(void 0)}),
4)}if(X.C!=2)return g.Fe(X,0);
H=g.Sa(X);return H instanceof g.F2&&H.type==="QUOTA_EXCEEDED"?g.y(X,p.vn("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):X.EY(0)})},VJc=function(p,C){var V;
return g.I(function(N){if(!p.T)return N.return();V=p.T;return g.y(N,gp(p.C,{mode:"readwrite",L4:!0},function(H){var X=[P9(H,V,"transfer")];C&&X.push(C(H));return g.f3.all(X)}),0)})},n8=function(p){p.T=void 0;
p.W=void 0;p.S.stop()},Hg5=function(p,C){var V,N,H,X,d;
return g.I(function(a){if(a.C==1)return V=g.tq(C.key),N=V.entityId,H=g.cJ(N,"playbackData"),g.y(a,Qa(p.C,H,"playbackData"),2);X=a.T;if((d=X)==null?0:d.playerResponseJson)return a.return(JSON.parse(X.playerResponseJson));throw Error("No PlayerResponse found");})},wQ=function(p,C){p.api.k_("woffle",{mcte:C});
jx("missing current transfer entity.")},PK=function(p,C){var V,N,H;
return g.I(function(X){if(X.C==1)return g.y(X,Qa(p.C,g.cJ(C,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);V=X.T;return X.return((H=(N=V)==null?void 0:N.offlineModeType)!=null?H:void 0)})},XF0=function(p){return EFp[p.transferState]!==void 0},d8f=function(p,C){var V=EFp[p.transferState],N=EFp[C.transferState];
return V!==N?V-N:Number(p.enqueuedTimestampMs)-Number(C.enqueuedTimestampMs)},L8=function(p,C){var V=this;
this.yn=p;this.api=C;this.Y=new g.Hl;this.W=new g.Zt;this.Sr={Ks:function(){return V.V.Sr.Ks()},
J4:function(){return V.Y},
yFr:function(){return V.V},
m2:function(){return V.m2()},
Qh:function(){return V.Qh()},
Xi:function(){return V.Xi()},
MM:function(){return V.MM()},
Xv:function(){return V.Xv()},
p5:function(N){return V.p5(N)}};
this.V=new B9p(function(){return lJ2(V)},function(){V.Xi()},this.api.Uu(),this.api.G.bind(this.api));
this.T=new VZ(this.api);Gu5(this.V)},lJ2=function(p){return g.I(function(C){p.api.Jk("onOrchestrationBecameLeader");
return g.y(C,p.Qh(),0)})},ck8=function(p){var C,V;
return g.I(function(N){if(N.C==1)return g.y(N,B9(),2);if(N.C!=3){C=N.T;if(!C)return jx("PES is undefined"),N.return();p.C=new rCr(C,p.api,p.V,p.T);V=p.cO(C);return g.y(N,qME(C,V,p.V,p.T,p.yn),3)}p.D=N.T;return g.y(N,tJr(p),0)})},tJr=function(p){var C;
return g.I(function(V){switch(V.C){case 1:if(!p.C)return jx("transferManager is undefined"),V.return();if(p.C.T){V.EY(2);break}return g.y(V,ex(p.C),2);case 2:if(!p.yn.G("woffle_enable_main_downloads_library")){V.EY(4);break}return g.y(V,p.XM(),4);case 4:if(!p.yn.G("html5_offline_playback_position_sync")){V.EY(6);break}return g.y(V,p.nE(),7);case 7:return g.y(V,p.p5(864E5),6);case 6:return g.y(V,p.refreshAllStaleEntities(43200,!0),9);case 9:return g.y(V,p.jp(),10);case 10:if(!p.yn.G("html5_retry_downloads_for_expiration")){V.EY(11);
break}return g.y(V,p.Xv(),11);case 11:return p.J=g.Se(function(){p.refreshAllStaleEntities(43200,!0);p.jp()},9E5),g.Vl(g.HW(),function(){return p.MM()}),g.y(V,B9(),13);
case 13:return C=V.T,g.y(V,rx2(C),14);case 14:ppr(p.V),g.JQ(V)}})},T0y=function(){var p,C,V,N,H,X;
return g.I(function(d){switch(d.C){case 1:return g.y(d,B9(),2);case 2:p=d.T;if(!p)return d.return([]);C=Date.now()/1E3;return g.y(d,rp(p,"offlineVideoPolicy"),3);case 3:V=d.T,N=g.F(V),H=N.next();case 4:if(H.done){d.EY(6);break}X=H.value;if(!(X.expirationTimestamp&&Number(X.expirationTimestamp)<C)){d.EY(5);break}X.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";X.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.y(d,W9(p,X,"offlineVideoPolicy"),5);
case 5:H=N.next();d.EY(4);break;case 6:return d.return(V.map(function(a){return a.key}))}})},gQ=function(p,C,V,N,H){var X,d,a;
return g.I(function(E){if(E.C==1)return g.y(E,B9(),2);X=E.T;if(!X)return E.return([]);d=C.map(function(l){var t=g.cJ(l,V);t={actionType:N,entityKey:t,actionMetadata:Object.assign({},s1Y(),H)};N!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(t.actionMetadata.priority=0);l=new Mw(V,l,t);return vK(l)});
a=mKE(X,d);Gu5(p.V);return E.return(a)})},MJc=function(p,C,V,N){var H,X,d,a,E,l,t,c;
return g.I(function(T){switch(T.C){case 1:H=[],X=g.F(C),d=X.next();case 2:if(d.done){T.EY(4);break}a=d.value;if(a.upToDate||V&&!a.shouldAutoSyncMetadata||!a.playlistId){T.EY(3);break}E={};switch(N){case "mainPlaylistEntity":l={nextAutoRefreshIntervalSeconds:a.checkInSeconds,autoSync:V};E={mainPlaylistEntityActionMetadata:l};break;case "musicPlaylist":t={autoSync:V},E={musicPlaylistEntityActionMetadata:t}}return g.y(T,gQ(p,[a.playlistId],N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E),6);case 6:(c=
T.T)&&H.push.apply(H,g.K(c));case 3:d=X.next();T.EY(2);break;case 4:return T.return(H)}})},JkF=function(p,C){var V;
return g.I(function(N){return C.length?(V=s1Y(),g.g7(V,oz,{isEnqueuedForExpiredStreamUrlRefetch:!0}),p.api.k_("qrd",{v:C.length}),N.return(gQ(p,C,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V))):N.return([])})},m80=function(p,C,V){this.T=p;
this.yn=C;this.V=V},SdY=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f;
return g.I(function(q){switch(q.C){case 1:return V=il(C),N=g.tq(C.entityKey),H=N.entityId,X=[],g.vv(q,2),g.y(q,vFE(p,H),4);case 4:X=q.T;if(!(p.yn.G("woffle_enable_main_downloads_library")&&((d=X)==null?0:d.length))){q.EY(5);break}return g.y(q,KO5(p.T,[C.entityKey]),5);case 5:g.Fe(q,3);break;case 2:return a=g.Sa(q),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.F2&&a.type==="QUOTA_EXCEEDED"?(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):jx("Playlist add error"),q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,E,l));case 3:t=[];if(!p.yn.G("html5_offline_prevent_redownload_downloaded_video")){q.EY(7);break}return g.y(q,ioE(p.T,"mainVideoEntity",X),8);case 8:X=q.T;case 7:if((c=X)==null?0:c.length)for(T=g.F(X),M=T.next();!M.done;M=T.next())if(J=M.value,S=J.offlineVideoData,D=void 0,(D=S)==null?0:D.videoId)Z=void 0,f=Number(((Z=C.actionMetadata)==null?void 0:Z.priority)||
0)+1,t.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S.videoId,"mainVideoEntity",f,WK,FlP(C,S,H)));return q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,t))}})},D82=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc,OS,V8,Tp,Bv,u,U,O,b,x,pY,d1,Hv,k,ES,my,i9,kH,hf,RF,cy,g1,zt,El,zA,Rt,wI,Dz,L6,We,$5,M$,k7,oX,T9,x7,Rs,kN,hc,uK,Hy,ZK,$Q;
return g.I(function(Tt){switch(Tt.C){case 1:return V=il(C),N=C.entityKey,H=g.tq(N).entityId,X=[],d=!1,H==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.y(Tt,rp(p.T,"mainPlaylistEntity"),5)):g.y(Tt,Qa(p.T,N,"mainPlaylistEntity"),4);case 4:(a=Tt.T)&&X.push(a);Tt.EY(3);break;case 5:X=Tt.T;case 3:if((E=X)==null||!E.length)return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));l=g.n(C.actionMetadata,Klf);c=(t=l)==null?void 0:t.nextAutoRefreshIntervalSeconds;M=(T=l)==null?void 0:T.autoSync;J=[];D=S=
!0;Z=!1;if(!d&&M===!1){Tt.EY(6);break}g.vv(Tt,7);return g.y(Tt,xZ8(0,!!M,!0,X),9);case 9:J=Tt.T;g.Fe(Tt,8);break;case 7:f=g.Sa(Tt);if(!(f instanceof Error&&f.message==="No data")){f instanceof Error&&f.message==="Empty response body"&&jx(f.message);Tt.EY(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.y(Tt,Mrc(p.T,C,p.V,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.y(Tt,cT2(H,p.T,C,p.V),8);case 8:if(!J.length||!d&&J[0].playlistId!==H)return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V));case 6:if(d){q=[];A=g.F(J);for(z=A.next();!z.done;z=A.next())Q=z.value,Q.upToDate||M&&!Q.shouldAutoSyncMetadata||!Q.playlistId||(P={nextAutoRefreshIntervalSeconds:Q.checkInSeconds,autoSync:M},q.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q.playlistId,"mainPlaylistEntity",0,WK,{mainPlaylistEntityActionMetadata:P})));return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,q))}J.length&&(VL=J[0],Z=!!VL.upToDate,M&&(S=(au=VL.shouldAutoSyncMetadata)!=null?au:!0,D=(W=VL.shouldAutoSyncVideos)!=
null?W:!0,VL.checkInSeconds&&(c=VL.checkInSeconds)));if(Z||!S)return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));e=[];B=X[0];if(!B.downloadState){v=void 0;Tt.EY(15);break}return g.y(Tt,Qa(p.T,B.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:v=Tt.T;case 15:return w=v,FG=((C0=w)==null?0:C0.addedTimestampMillis)?String(w.addedTimestampMillis):void 0,g.vv(Tt,17),g.y(Tt,vFE(p,H,FG,c),19);case 19:e=Tt.T;g.Fe(Tt,18);break;case 17:Nc=g.Sa(Tt);if(!(Nc instanceof Error&&
Nc.message==="No data for playlist")){if(Nc instanceof Error&&Nc.message==="Empty response body for playlist")jx(Nc.message);else return OS="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V8="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Nc instanceof g.F2&&Nc.type==="QUOTA_EXCEEDED"&&(OS="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",V8="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,OS,V8));Tt.EY(18);
break}return g.y(Tt,cT2(H,p.T,C,p.V),18);case 18:if(!D)return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));Tp=[];Bv=new Map;if((u=e)==null?0:u.length)for(U=g.F(e),O=U.next();!O.done;O=U.next())b=O.value,x=b.offlineVideoData,pY=void 0,((pY=x)==null?0:pY.videoId)&&Bv.set(x.videoId,x);d1=new Map;Hv=[];if((k=B)==null?0:(ES=k.videos)==null?0:ES.length)for(my=g.F(B.videos),i9=my.next();!i9.done;i9=my.next())if(kH=i9.value,hf=JSON.parse(g.tq(kH).entityId),RF=hf.videoId)Bv.has(RF)?(d1.set(RF,
Bv.get(RF)),Bv.delete(RF)):Hv.push(RF);g1=Number(((cy=C.actionMetadata)==null?void 0:cy.priority)||0)+1;zt=g.F(Bv.entries());for(El=zt.next();!El.done;El=zt.next())zA=El.value,Rt=g.F(zA),wI=Rt.next().value,Dz=Rt.next().value,L6=wI,We=Dz,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",L6,"mainVideoEntity",g1,WK,FlP(C,We,H)));$5=g.F(d1.entries());for(M$=$5.next();!M$.done;M$=$5.next())k7=M$.value,oX=g.F(k7),T9=oX.next().value,x7=oX.next().value,Rs=T9,kN=x7,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Rs,"mainVideoEntity",g1,WK,FlP(C,kN,H)));hc=g.F(Hv);for(uK=hc.next();!uK.done;uK=hc.next())Hy=uK.value,ZK={playlistId:H},$Q={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:ZK},Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Hy,"mainVideoEntity",0,WK,$Q));return Tt.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,Tp))}})},uVY=function(p,C){var V,N,H,X;
return g.I(function(d){switch(d.C){case 1:return V=il(C),g.vv(d,2),N=g.tq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(d,Mrc(p.T,C,p.V,(H=C.actionMetadata)==null?void 0:(X=H.offlineLoggingData)==null?void 0:X.offlineDeleteReason),5):g.y(d,cT2(N,p.T,C,p.V),6);case 6:if(!p.yn.G("woffle_enable_main_downloads_library")){d.EY(5);break}return g.y(d,DZF(p.T,C.entityKey),5);case 5:g.Fe(d,3);break;case 2:return g.Sa(d),d.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},vFE=function(p,C,V,N){var H,X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:return g.y(c,oC2([C]),2);case 2:return H=c.T,g.y(c,ZgE(p,H[0],V,N),3);case 3:return X=c.T,d=X.mainPlaylistEntity,a=X.nt_,l=lA0(d,(E=a)==null?void 0:E.avatar),g.vv(c,4),g.y(c,Sx(l),6);case 6:g.Fe(c,5);break;case 4:t=g.Sa(c),t instanceof Error&&t.message==="Failed to fetch"&&jx(t.message);case 5:return c.return(H[0].videos)}})},ZgE=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A;
return g.I(function(z){switch(z.C){case 1:H=Date.now().toString();V||(V=H);X=C.videos;d=C.playlistId;a=[];E=[];if(X)for(l=g.F(X),t=l.next();!t.done;t=l.next()){c=t.value;T=c.offlineVideoData;if(!T||!T.videoId)throw jx("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");M=T.videoId;J={videoId:M,playlistId:d};S={id:g.cJ(JSON.stringify(J),"mainPlaylistVideoEntity"),video:g.cJ(M,"mainVideoEntity")};a.push(S);E.push(S.id)}Z={key:g.cJ(d,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:V,lastSyncedTimestampMillis:H};f={key:g.cJ(d,"mainPlaylistEntity"),playlistId:d,videos:E,title:C.title,thumbnailStyleData:U85(C),visibility:fJy(C),downloadState:Z.key};C.channel&&(q=C.channel.offlineChannelData,D=Og2(g.cJ(d,"ytMainChannelEntity"),q),f.channelOwner=D.id);((A=f)==null?0:A.entityMetadata)?(f.entityMetadata.offlineLastModifiedTimestampSeconds=C.lastModifiedTimestamp,N&&(f.entityMetadata.nextAutoRefreshIntervalSeconds=String(N))):f&&(f.entityMetadata={nextAutoRefreshIntervalSeconds:N?
String(N):void 0,offlineLastModifiedTimestampSeconds:C.lastModifiedTimestamp});g.vv(z,2);return g.y(z,gp(p.T,{mode:"readwrite",L4:!0},function(Q){var P=P9(Q,f,"mainPlaylistEntity"),VL=P9(Q,Z,"mainPlaylistDownloadStateEntity");P=[P,VL];VL=g.F(a);for(var au=VL.next();!au.done;au=VL.next())P.push(P9(Q,au.value,"mainPlaylistVideoEntity"));D&&P.push(P9(Q,D,"ytMainChannelEntity"));return g.f3.all(P)}),4);
case 4:g.Fe(z,3);break;case 2:throw g.Sa(z),jx("PES failure for playlist"),Error("PES failure for playlist");case 3:return z.return({mainPlaylistEntity:f,nt_:D,IJa:a})}})},Og2=function(p,C){return{id:p,
channelId:C.channelId,title:C.title,avatar:C.thumbnail}},U85=function(p){var C=[],V=p.videos;
V&&V.length>0&&C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:V[0].offlineVideoData.thumbnail}}});if((p=p.additionalMetadadatas)&&p.length>0)for(p=g.F(p),V=p.next();!V.done;V=p.next()){var N=V.value.offlineBundleItemPlaylistData,H=void 0;V=(H=N)==null?void 0:H.style;H=void 0;N={collageThumbnail:{coverThumbnail:(H=N)==null?void 0:H.coverThumbnail}};switch(V){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:N});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:N});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:N});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":C.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:N})}}return C},fJy=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},FlP=function(p,C,V){C={offlineVideoData:C,
playlistId:V};if(p=g.n(p.actionMetadata,Klf))C.maximumDownloadQuality=p.maximumDownloadQuality;return{mainVideoEntityActionMetadata:C}},ykY=function(p,C,V){this.T=p;
this.yn=C;this.V=V},bgc=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J;
return g.I(function(S){switch(S.C){case 1:return V=il(C),N=g.tq(C.entityKey),H=N.entityId,X=g.n(C.actionMetadata,QZ),a=!((d=X)==null?0:d.playlistId),g.vv(S,2),g.y(S,qdF(p,H,void 0,(E=X)==null?void 0:E.offlineVideoData,a),4);case 4:g.Fe(S,3);break;case 2:return l=g.Sa(S),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.F2&&l.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
S.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,t,c));case 3:T=1;T=Number(((M=C.actionMetadata)==null?void 0:M.priority)||0)+1;var D=(D=g.n(C.actionMetadata,QZ))?{playbackDataActionMetadata:{maximumDownloadQuality:D.maximumDownloadQuality}}:void 0;J=bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",T,IJy,D);return S.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,[J]))}})},AkE=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f;
return g.I(function(q){switch(q.C){case 1:return V=il(C),N=g.tq(C.entityKey),H=N.entityId,g.y(q,Qa(p.T,C.entityKey,"mainVideoEntity"),2);case 2:X=q.T;if(!X){d=void 0;q.EY(3);break}return g.y(q,Qa(p.T,X.downloadState,"mainVideoDownloadStateEntity"),4);case 4:d=q.T;case 3:a=d;if(!X||!a)return q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.vv(q,5);return g.y(q,qdF(p,H,a.addedTimestampMillis,(l=g.n(C.actionMetadata,QZ))==null?void 0:l.offlineVideoData),7);case 7:t=1;t=Number(((c=
C.actionMetadata)==null?void 0:c.priority)||0)+1;E=bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",t,IJy);g.Fe(q,6);break;case 5:T=g.Sa(q);if(!(T instanceof Error&&T.message==="No data")){if(T instanceof Error&&T.message==="Empty response body")jx(T.message);else return M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.F2&&T.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,M,J));q.EY(6);break}return g.y(q,ul(p.T,H),9);case 9:S=q.T;D=g.n(C.actionMetadata,QZ);if(f=(Z=D)==null?void 0:Z.playlistId)S.playlistId=f;S.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.y(q,K8(H,p.T,C,p.V,S),6);case 6:return q.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,E?[E]:void 0))}})},oF5=function(p,C){var V,N,H,X,d,a,E,l,t,c;
return g.I(function(T){switch(T.C){case 1:return V=il(C),g.vv(T,2),N=g.tq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(T,Mrc(p.T,C,p.V,(t=C.actionMetadata)==null?void 0:(c=t.offlineLoggingData)==null?void 0:c.offlineDeleteReason),5):g.y(T,ul(p.T,N),6);case 6:H=T.T;X=g.n(C.actionMetadata,QZ);if(a=(d=X)==null?void 0:d.playlistId)H.playlistId=a;H.offlineDeleteReason=(E=C.actionMetadata)==null?void 0:(l=E.offlineLoggingData)==null?void 0:l.offlineDeleteReason;return g.y(T,K8(N,p.T,C,p.V,H),7);
case 7:if(!p.yn.G("woffle_enable_main_downloads_library")){T.EY(5);break}return g.y(T,DZF(p.T,C.entityKey),5);case 5:g.Fe(T,3);break;case 2:return g.Sa(T),T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},qdF=function(p,C,V,N,H){var X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:if(X=N){c.EY(2);break}return g.y(c,AT5([C]),3);case 3:d=c.T,X=d[0];case 2:return g.y(c,kzf(p,X,V,H),4);case 4:a=c.T;E=a.mainVideoEntity;l=a.channelEntity;g.vv(c,5);var T=TY(E.thumbnail),M=TY(l.avatar);return g.y(c,Sx(T.concat(M)),7);case 7:g.Fe(c,0);break;case 5:t=g.Sa(c),t instanceof Error&&t.message==="Failed to fetch"&&jx(t.message),g.JQ(c)}})},kzf=function(p,C,V,N){var H,X,d,a,E,l,t,c,T,M,J,S,D;
return g.I(function(Z){switch(Z.C){case 1:V||(V=Date.now().toString());X=(H=C.channel)==null?void 0:H.offlineChannelData;d={id:g.cJ(C.videoId,"ytMainChannelEntity"),channelId:X.channelId,title:X.title,avatar:X.thumbnail};a={key:g.cJ(C.videoId,"mainVideoDownloadStateEntity"),playbackData:g.cJ(C.videoId,"playbackData"),addedTimestampMillis:V,videoDownloadContextEntity:g.cJ(C.videoId,"videoDownloadContextEntity")};E={key:g.cJ(C.videoId,"videoPlaybackPositionEntity"),videoId:C.videoId,lastPlaybackPositionSeconds:"0"};
p.yn.G("html5_offline_playback_position_sync")&&(l={playbackPosition:E.key});t=g.cJ(C.videoId,"mainVideoEntity");c={key:t,videoId:C.videoId,title:C.title,thumbnail:C.thumbnail,localizedStrings:{viewCount:C.shortViewCountText},userState:l,lengthSeconds:C.lengthSeconds?Number(C.lengthSeconds):void 0,publishedTimestampMillis:C.publishedTimestamp?(Number(C.publishedTimestamp)*1E3).toString():void 0,formattedDescription:C.description,owner:d.id,downloadState:a.key};if(!p.yn.G("woffle_enable_main_downloads_library")||
!N){Z.EY(2);break}return g.y(Z,SHc(p.T,[t]),3);case 3:if(J=Z.T)T=J.mainDownloadsLibraryEntity,M=J.mainDownloadsListEntity;case 2:return D=dZv,S={key:g.cJ(C.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.g7(a,D,S),g.y(Z,gp(p.T,{mode:"readwrite",L4:!0},function(f){var q=P9(f,d,"ytMainChannelEntity"),A=P9(f,a,"mainVideoDownloadStateEntity"),z=P9(f,c,"mainVideoEntity");q=[q,A,z];p.yn.G("html5_offline_playback_position_sync")&&(A=P9(f,E,"videoPlaybackPositionEntity"),
q.push(A));T&&(A=P9(f,T,"mainDownloadsLibraryEntity"),q.push(A));M&&(A=P9(f,M,"mainDownloadsListEntity"),q.push(A));S&&(f=P9(f,S,"downloadStatusEntity"),q.push(f));return g.f3.all(q)}),4);
case 4:return Z.return({mainVideoEntity:c,channelEntity:d})}})},x88=function(p,C,V){this.T=p;
this.yn=C;this.V=V},zoy=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B;
return g.I(function(v){switch(v.C){case 1:return V=il(C),N=[],g.y(v,x8.getInstance(),2);case 2:H=v.T;if(!H){v.EY(3);break}return g.y(v,H.get("sdois"),4);case 4:return X=v.T,g.y(v,(a=H)==null?void 0:a.get("lmqf"),5);case 5:d=v.T;case 3:g.vv(v,6);if(X===void 0)throw Error("prefStorage or opt-in state is undefined");E=[];if(X){v.EY(8);break}return g.y(v,FO0(p.T),9);case 9:E=v.T,E.reverse();case 8:if(!E.length){v.EY(10);break}l=g.F(E);t=l.next();case 11:if(t.done){v.EY(10);break}c=t.value;if(!c){v.EY(12);
break}T=g.tq(c).entityId;return g.y(v,ul(p.T,T),14);case 14:return M=v.T,M.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.y(v,K8(T,p.T,{entityKey:c,actionType:C.actionType},p.V,M),12);case 12:t=l.next();v.EY(11);break;case 10:return g.y(v,zzf(X,(J=d)!=null?J:"SD"),16);case 16:return S=v.T,g.y(v,JTP(S),17);case 17:D=vCr(S);if(!p.yn.G("woffle_enable_main_downloads_library")){v.EY(18);break}if(X){v.EY(19);break}return g.y(v,DZF(p.T,g.bS),19);case 19:return g.y(v,KO5(p.T,[g.bS]),18);
case 18:if((Z=D)==null?0:Z.length)for(f=g.F(D),q=f.next();!q.done;q=f.next())if(z=A=q.value,Q=z.actionType,P=z.entityKey,VL=z.actionMetadata,Q&&P&&VL&&!g.n(VL,Yd1)){Q==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(VL.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(au=g.n(A.actionMetadata,QZ))au.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",A.actionMetadata=Object.assign({},A.actionMetadata,{mainVideoEntityActionMetadata:au});N.push(A)}g.Fe(v,7);break;
case 6:return W=g.Sa(v),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.F2&&W.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,e,B));case 7:return v.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,N))}})},Ror=function(){L8.apply(this,arguments);
this.Z="mainVideoEntity"},nFr=function(p,C,V){C=C===void 0?43200:C;
V=V===void 0?!0:V;var N=N===void 0?!1:N;var H,X,d;return g.I(function(a){switch(a.C){case 1:if(!p.Y.nO())return a.return([]);H=[];g.vv(a,2);return g.y(a,xZ8(C,V,N),4);case 4:H=a.T;g.Fe(a,3);break;case 2:X=g.Sa(a),X instanceof Error&&X.message==="No data"||X instanceof Error&&X.message==="Empty response body"&&jx(X.message);case 3:return d=MJc(p,H,V,"mainPlaylistEntity"),a.return(d)}})},eov=function(p,C,V,N){N=N===void 0?!1:N;
var H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f;return g.I(function(q){switch(q.C){case 1:return H=[],g.y(q,YHc(),2);case 2:return(X=q.T)||N?g.y(q,Rz1(C,V),3):q.return([]);case 3:d=q.T;if((a=d)==null||!a.length)return q.return([]);E={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};l=g.F(d);t=l.next();case 4:if(t.done){q.EY(6);break}T=c=t.value;M=T.actionType;J=T.entityKey;S=T.actionMetadata;if(!(M&&J&&S)||g.n(S,Yd1)){q.EY(5);break}M==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(S.offlineLoggingData=
E);D=g.tq(J);Z=D.entityId;return g.y(q,gQ(p,[Z],"mainVideoEntity",M,S),8);case 8:f=q.T,H=H.concat(f);case 5:t=l.next();q.EY(4);break;case 6:return q.return(H)}})},PIF=function(p,C){this.T=p;
this.V=C},$8P=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z;
return g.I(function(f){switch(f.C){case 1:return V=il(C),N=g.tq(C.entityKey),H=N.entityId,X=[],g.vv(f,2),g.y(f,wF5(p,H),4);case 4:X=f.T;if((d=X)==null||!d.length){f.EY(5);break}return g.y(f,OoF(p.T,C.entityKey),5);case 5:g.Fe(f,3);break;case 2:return a=g.Sa(f),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.F2&&a.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
f.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,E,l));case 3:return t=[],g.y(f,ioE(p.T,"musicTrack",X),7);case 7:X=f.T;if(X.length)for(c=g.F(X),T=c.next();!T.done;T=c.next())if(M=T.value,J=M.offlineVideoData,S=void 0,(S=J)==null?0:S.videoId)D=void 0,Z=Number(((D=C.actionMetadata)==null?void 0:D.priority)||0)+1,t.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J.videoId,"musicTrack",Z,rQ,Os(C,J,H)));return f.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,t))}})},
Ll2=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc,OS,V8,Tp,Bv,u,U,O,b,x,pY,d1,Hv,k,ES,my,i9,kH,hf,RF,cy,g1,zt,El,zA,Rt,wI,Dz;
return g.I(function(L6){switch(L6.C){case 1:return V=il(C),N=C.entityKey,H=g.tq(N).entityId,X=[],d=!1,H==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.y(L6,rp(p.T,"musicAlbumRelease"),5)):g.y(L6,Qa(p.T,N,"musicAlbumRelease"),4);case 4:(a=L6.T)&&X.push(a);L6.EY(3);break;case 5:X=L6.T;case 3:if((E=X)==null||!E.length)return L6.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));if(d){l=[];t=g.F(X);for(c=t.next();!c.done;c=t.next())T=c.value,M=g.tq(T.id).entityId,l.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
M,"musicAlbumRelease",0,rQ));return L6.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,l))}J=[];S=X[0];D=void 0;if(!S.downloadMetadata){L6.EY(6);break}return g.y(L6,Qa(p.T,S.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:Z=L6.T,D=Number((q=(f=Z)==null?void 0:f.addedTimestampMillis)!=null?q:"0")/1E3;case 6:return g.vv(L6,8),g.y(L6,wF5(p,H,(A=D)==null?void 0:A.toString()),10);case 10:J=L6.T;g.Fe(L6,9);break;case 8:z=g.Sa(L6);if(!(z instanceof Error&&z.message===
"No data")){if(z instanceof Error&&z.message==="Empty response body")jx(z.message);else return Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.F2&&z.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L6.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,Q,P));L6.EY(9);break}return g.y(L6,Us(H,"musicAlbumRelease",p.T,
C,p.V),9);case 9:VL=[];au=new Map;if((W=J)==null?0:W.length)for(e=g.F(J),B=e.next();!B.done;B=e.next())v=B.value,w=v.offlineVideoData,C0=void 0,((C0=w)==null?0:C0.videoId)&&au.set(w.videoId,w);FG=new Map;Nc=[];if((OS=S)==null?0:(V8=OS.tracks)==null?0:V8.length)for(Tp=g.F(S.tracks),Bv=Tp.next();!Bv.done;Bv=Tp.next())if(u=Bv.value,U=g.tq(u).entityId)au.has(U)?(FG.set(U,au.get(U)),au.delete(U)):Nc.push(U);b=Number(((O=C.actionMetadata)==null?void 0:O.priority)||0)+1;x=g.F(au.entries());for(pY=x.next();!pY.done;pY=
x.next())d1=pY.value,Hv=g.F(d1),k=Hv.next().value,ES=Hv.next().value,my=k,i9=ES,VL.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",my,"musicTrack",b,rQ,Os(C,i9)));kH=g.F(FG.entries());for(hf=kH.next();!hf.done;hf=kH.next())RF=hf.value,cy=g.F(RF),g1=cy.next().value,zt=cy.next().value,El=g1,zA=zt,VL.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",El,"musicTrack",b,rQ,Os(C,zA)));Rt=g.F(Nc);for(wI=Rt.next();!wI.done;wI=Rt.next())Dz=wI.value,VL.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Dz,
"musicTrack",0,rQ));return L6.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,VL))}})},gFv=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.vv(H,2),N=g.tq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(H,f8(p.T,C,p.V),5):g.y(H,Us(N,"musicAlbumRelease",p.T,C,p.V),6);case 6:return g.y(H,yT2(p.T,C.entityKey),5);case 5:g.Fe(H,3);break;case 2:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},wF5=function(p,C,V){var N,H,X;
return g.I(function(d){switch(d.C){case 1:return g.y(d,oC2([C]),2);case 2:return N=d.T,g.y(d,Wl0(p,N[0],V),3);case 3:return H=d.T,X=TY(H.thumbnailDetails),g.y(d,Sx(X),4);case 4:return d.return(N[0].videos)}})},Wl0=function(p,C,V){var N,H,X,d,a,E,l,t,c,T,M,J,S,D;
return g.I(function(Z){if(Z.C==1){N=C.additionalMetadadatas;H=void 0;if(N&&N.length>0)for(X=g.F(N),d=X.next();!d.done;d=X.next())if(a=d.value,a.offlineMusicPlaylistData){H=a.offlineMusicPlaylistData;break}E=C.playlistId;l=qHv(C);t=l.t1;c=l.BD;T=V?(Number(V)*1E3).toString():Date.now().toString();M=C.lastModifiedTimestamp?(Number(C.lastModifiedTimestamp)*1E3).toString():"0";J={id:g.cJ(E,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:c,lastModifiedTimestampMillis:M,addedTimestampMillis:T,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};S={id:g.cJ(E,"musicAlbumRelease"),title:C.title,audioPlaylistId:E,trackCount:C.totalVideoCount,tracks:t,downloadMetadata:J.id};H&&(S.thumbnailDetails=(D=H.albumHqThumbnail)!=null?D:H.albumArtistThumbnail,S.artistDisplayName=H.albumArtistDisplayName,S.releaseDate=H.albumReleaseDate,S.contentRating={explicitType:H.albumReleaseExplicitType},S.releaseType=H.albumReleaseType);return g.y(Z,gp(p.T,{mode:"readwrite",L4:!0},function(f){var q=P9(f,S,"musicAlbumRelease");
f=P9(f,J,"musicAlbumReleaseDownloadMetadataEntity");return g.f3.all([q,f])}),2)}return Z.return(S)})},QLf=function(p,C){this.T=p;
this.V=C},B08=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z;
return g.I(function(f){switch(f.C){case 1:return V=il(C),N=g.tq(C.entityKey),H=N.entityId,X=[],g.vv(f,2),g.y(f,rk8(p,H),4);case 4:X=f.T;if((d=X)==null||!d.length){f.EY(5);break}return g.y(f,OoF(p.T,C.entityKey),5);case 5:g.Fe(f,3);break;case 2:return a=g.Sa(f),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.F2&&a.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
f.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,E,l));case 3:return t=[],g.y(f,ioE(p.T,"musicTrack",X),7);case 7:X=f.T;if(X.length)for(c=g.F(X),T=c.next();!T.done;T=c.next())if(M=T.value,J=M.offlineVideoData,S=void 0,(S=J)==null?0:S.videoId)D=void 0,Z=Number(((D=C.actionMetadata)==null?void 0:D.priority)||0)+1,t.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J.videoId,"musicTrack",Z,BK,Os(C,J,H)));return f.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,t))}})},
GzG=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc,OS,V8,Tp,Bv,u,U,O,b,x,pY,d1,Hv,k,ES,my,i9,kH,hf,RF,cy,g1,zt,El,zA,Rt,wI,Dz,L6,We,$5,M$,k7,oX,T9,x7,Rs,kN,hc,uK;
return g.I(function(Hy){switch(Hy.C){case 1:return V=il(C),N=C.entityKey,H=g.tq(N).entityId,X=[],d=!1,H==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.y(Hy,rp(p.T,"musicPlaylist"),5)):g.y(Hy,Qa(p.T,N,"musicPlaylist"),4);case 4:(a=Hy.T)&&X.push(a);Hy.EY(3);break;case 5:X=Hy.T;case 3:if((E=X)==null||!E.length)return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));l=g.n(C.actionMetadata,IAG);c=(t=l)==null?void 0:t.autoSync;T=[];J=M=!0;S=!1;D=void 0;if(!d&&c===!1){Hy.EY(6);break}g.vv(Hy,7);return g.y(Hy,
nC1(0,!!c,!0,X),9);case 9:T=Hy.T;g.Fe(Hy,8);break;case 7:Z=g.Sa(Hy);if(!(Z instanceof Error&&Z.message==="No data")){Z instanceof Error&&Z.message==="Empty response body"&&jx(Z.message);Hy.EY(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.y(Hy,f8(p.T,C,p.V),8):g.y(Hy,Us(H,"musicPlaylist",p.T,C,p.V),8);case 8:if(!T.length||!d&&T[0].playlistId!==H)return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));case 6:if(d){f=[];q=g.F(T);for(A=q.next();!A.done;A=q.next())z=A.value,z.upToDate||
c&&!z.shouldAutoSyncMetadata||!z.playlistId||(Q={autoSync:c},f.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",z.playlistId,"musicPlaylist",0,BK,{musicPlaylistEntityActionMetadata:Q})));return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,f))}T.length&&(P=T[0],S=!!P.upToDate,c&&(M=(VL=P.shouldAutoSyncMetadata)!=null?VL:!0,J=(au=P.shouldAutoSyncVideos)!=null?au:!0,P.checkInSeconds&&(D=P.checkInSeconds)));if(S||!M)return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V));W=[];e=X[0];B=void 0;if(!e.downloadMetadata){Hy.EY(15);break}return g.y(Hy,Qa(p.T,e.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:v=Hy.T,B=Number((C0=(w=v)==null?void 0:w.addedTimestampMillis)!=null?C0:"0")/1E3;case 15:return g.vv(Hy,17),g.y(Hy,rk8(p,H,(FG=B)==null?void 0:FG.toString(),D),19);case 19:W=Hy.T;g.Fe(Hy,18);break;case 17:Nc=g.Sa(Hy);if(!(Nc instanceof Error&&Nc.message==="No data")){if(Nc instanceof Error&&Nc.message==="Empty response body")jx(Nc.message);else return OS=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V8="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Nc instanceof g.F2&&Nc.type==="QUOTA_EXCEEDED"&&(OS="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",V8="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,OS,V8));Hy.EY(18);break}return g.y(Hy,Us(H,"musicPlaylist",p.T,C,p.V),18);case 18:if(!J)return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V));Tp=[];Bv=new Map;if((u=W)==null?0:u.length)for(U=g.F(W),O=U.next();!O.done;O=U.next())b=O.value,x=b.offlineVideoData,pY=void 0,((pY=x)==null?0:pY.videoId)&&Bv.set(x.videoId,x);d1=new Map;Hv=[];if((k=e)==null?0:(ES=k.tracks)==null?0:ES.length)for(my=g.F(e.tracks),i9=my.next();!i9.done;i9=my.next())if(kH=i9.value,hf=g.tq(kH).entityId)Bv.has(hf)?(d1.set(hf,Bv.get(hf)),Bv.delete(hf)):Hv.push(hf);cy=Number(((RF=C.actionMetadata)==null?void 0:RF.priority)||0)+1;g1=g.F(Bv.entries());for(zt=g1.next();!zt.done;zt=
g1.next())El=zt.value,zA=g.F(El),Rt=zA.next().value,wI=zA.next().value,Dz=Rt,L6=wI,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Dz,"musicTrack",cy,BK,Os(C,L6)));We=g.F(d1.entries());for($5=We.next();!$5.done;$5=We.next())M$=$5.value,k7=g.F(M$),oX=k7.next().value,T9=k7.next().value,x7=oX,Rs=T9,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x7,"musicTrack",cy,BK,Os(C,Rs)));kN=g.F(Hv);for(hc=kN.next();!hc.done;hc=kN.next())uK=hc.value,Tp.push(bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
uK,"musicTrack",0,BK));return Hy.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,Tp))}})},p6E=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.vv(H,2),N=g.tq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(H,f8(p.T,C,p.V),5):g.y(H,Us(N,"musicPlaylist",p.T,C,p.V),6);case 6:return g.y(H,yT2(p.T,C.entityKey),5);case 5:g.Fe(H,3);break;case 2:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},rk8=function(p,C,V,N){var H,X,d;
return g.I(function(a){switch(a.C){case 1:return g.y(a,oC2([C]),2);case 2:return H=a.T,g.y(a,Cay(p,H[0],V,N),3);case 3:return X=a.T,d=TY(X.thumbnailDetails),g.y(a,Sx(d),4);case 4:return a.return(H[0].videos)}})},Cay=function(p,C,V,N){var H,X,d,a,E,l,t,c,T;
return g.I(function(M){return M.C==1?(H=C.playlistId,X=qHv(C),d=X.t1,a=X.BD,E=V?(Number(V)*1E3).toString():Date.now().toString(),l=C.lastModifiedTimestamp?(Number(C.lastModifiedTimestamp)*1E3).toString():"0",t={id:g.cJ(H,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:a,lastModifiedTimestampMillis:l,addedTimestampMillis:E,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},c={id:g.cJ(H,"musicPlaylist"),title:C.title,playlistId:H,thumbnailDetails:C.thumbnail,visibility:j6P(C),trackCount:C.totalVideoCount,
tracks:d,downloadMetadata:t.id},N&&(((T=c)==null?0:T.entityMetadata)?c.entityMetadata.nextAutoRefreshIntervalSeconds=String(N):c&&(c.entityMetadata={nextAutoRefreshIntervalSeconds:String(N)})),g.y(M,gp(p.T,{mode:"readwrite",L4:!0},function(J){var S=P9(J,c,"musicPlaylist");J=P9(J,t,"musicPlaylistDownloadMetadataEntity");return g.f3.all([S,J])}),2)):M.return(c)})},j6P=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},V7r=function(p,C){this.T=p;
this.V=C},dvc=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J;
return g.I(function(S){switch(S.C){case 1:return V=il(C),N=g.tq(C.entityKey),H=N.entityId,X=g.n(C.actionMetadata,Nff),g.vv(S,2),g.y(S,HdP(p,H,void 0,(d=X)==null?void 0:d.track,(a=X)==null?void 0:a.albumRelease),4);case 4:if((E=X)==null?0:E.playlistId){S.EY(5);break}return g.y(S,OoF(p.T,C.entityKey),5);case 5:g.Fe(S,3);break;case 2:return l=g.Sa(S),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.F2&&l.type==="QUOTA_EXCEEDED"&&
(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,t,c));case 3:M=Number(((T=C.actionMetadata)==null?void 0:T.priority)||0)+1;var D=(D=g.n(C.actionMetadata,Nff))?{playbackDataActionMetadata:{maximumDownloadQuality:D.maximumDownloadQuality}}:void 0;J=bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",M,X6E,D);return S.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V,[J]))}})},id0=function(p,C){var V,N,H,X,d,a,E,l,t,c,T,M,J,S,D;
return g.I(function(Z){switch(Z.C){case 1:return V=il(C),N=g.tq(C.entityKey),H=N.entityId,g.y(Z,Qa(p.T,C.entityKey,"musicTrack"),2);case 2:X=Z.T;if(!X){d=void 0;Z.EY(3);break}return g.y(Z,Qa(p.T,X.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:d=Z.T;case 3:a=d;if(!X||!a)return Z.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));l=g.n(C.actionMetadata,Nff);g.vv(Z,5);return g.y(Z,HdP(p,H,a.addedTimestampMillis,(t=l)==null?void 0:t.track,(c=l)==null?void 0:c.albumRelease),
7);case 7:M=Number(((T=C.actionMetadata)==null?void 0:T.priority)||0)+1;E=bl("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",M,X6E);g.Fe(Z,6);break;case 5:J=g.Sa(Z);if(!(J instanceof Error&&J.message==="No data")){if(J instanceof Error&&J.message==="Empty response body")jx(J.message);else return S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.F2&&J.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,S,D));Z.EY(6);break}return g.y(Z,Z2(H,p.T,C,p.V),6);case 6:return Z.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,E?[E]:void 0))}})},hiY=function(p,C){var V,N;
return g.I(function(H){switch(H.C){case 1:return V=il(C),g.vv(H,2),N=g.tq(C.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.y(H,f8(p.T,C,p.V),5):g.y(H,Z2(N,p.T,C,p.V),6);case 6:return g.y(H,yT2(p.T,C.entityKey),5);case 5:g.Fe(H,3);break;case 2:return g.Sa(H),H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Ag("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},HdP=function(p,C,V,N,H){var X,d,a,E,l,t;
return g.I(function(c){switch(c.C){case 1:if(X=N){c.EY(2);break}return g.y(c,AT5([C]),3);case 3:d=c.T,a=d[0],X=fA0(a);case 2:return g.y(c,s62(p,X,C,H,V),4);case 4:E=c.T;l=E.musicTrackEntity;t=E.jw;var T=TY(l.thumbnailDetails),M=[];t&&(M=TY(t.thumbnailDetails));return g.y(c,Sx(T.concat(M)),0)}})},s62=function(p,C,V,N,H){var X;
return g.I(function(d){return d.C==1?(H||(H=Date.now().toString()),X={id:g.cJ(V,"musicTrackDownloadMetadataEntity"),playbackData:g.cJ(V,"playbackData"),addedTimestampMillis:H,videoDownloadContextEntity:g.cJ(V,"videoDownloadContextEntity")},N&&(C.albumRelease=N.id),g.y(d,gp(p.T,{mode:"readwrite",L4:!0},function(a){var E=[],l=P9(a,X,"musicTrackDownloadMetadataEntity");E.push(l);l=P9(a,C,"musicTrack");E.push(l);N&&(a=P9(a,N,"musicAlbumRelease"),E.push(a));return g.f3.all(E)}),2)):d.C!=3?g.y(d,ll(V,"musicTrackDownloadMetadataEntity",
p.T,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):d.return({musicTrackEntity:C,
jw:N})})},GY=function(){L8.apply(this,arguments);
this.Z="musicTrack"},aDy=function(p,C,V){C=C===void 0?43200:C;
V=V===void 0?!0:V;var N=N===void 0?!1:N;var H,X;return g.I(function(d){switch(d.C){case 1:if(!p.Y.nO())return d.return([]);H=[];g.vv(d,2);return g.y(d,nC1(C,V,N),4);case 4:H=d.T;g.Fe(d,3);break;case 2:g.Sa(d);case 3:return X=MJc(p,H,V,"musicPlaylist"),d.return(X)}})},EQE=function(){g.IT.apply(this,arguments);
var p=this;this.events=new g.Rr(this);this.yn=this.player.K();this.Sr={Tno:function(){return p.T},
hR:function(){return p.hR()},
JL:function(C){return p.JL(C)}}},lDP=function(p){var C;
p=g.n((C=p.getWatchNextResponse())==null?void 0:C.currentVideoEndpoint,g.VB);if(p==null?0:p.playlistId)var V=p.playlistId;return V},t7r=function(p,C){var V,N,H,X;
return g.I(function(d){if(d.C==1){V=C.clientPlaybackNonce;N={cpn:V,offlineSourceVisualElement:g.ym(C.Sa||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};C.C&&(N.videoFmt=Number(C.C.itag));C.S&&(N.audioFmt=Number(C.S.itag));if((H=lDP(C))&&C.videoId){var a=C.videoId;a=H!=="PPSV"?Promise.resolve(!1):p.T.ZB(a);d=g.y(d,a,3)}else d=d.EY(2);return d}d.C!=2&&(X=d.T)&&(N.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");p.C=V;g.t1("offlinePlaybackStarted",N);g.JQ(d)})};
g.m(oU,Ai);g.Xe.Object.defineProperties(oU.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.T.entityMetadata},
set:function(p){this.T.entityMetadata=p}}});
g.m(lq0,oU);lq0.prototype.C=function(){return[]};
g.m(tZE,oU);tZE.prototype.C=function(){return[]};
g.m(cEY,oU);cEY.prototype.C=function(){return[]};
g.m(Thf,oU);Thf.prototype.C=function(){var p=[];this.T.alternateChannel&&p.push(this.T.alternateChannel);this.T.alternateChannelList&&p.push.apply(p,g.K(this.T.alternateChannelList));this.T.oneofChannelEntity&&p.push(this.T.oneofChannelEntity);return[].concat(g.K(new Set(p)))};
g.m(MZv,oU);MZv.prototype.C=function(){var p=[];this.T.entryCollection&&p.push(this.T.entryCollection);return[].concat(g.K(new Set(p)))};
g.m(JEp,Ai);JEp.prototype.C=function(){var p=[];this.T.video&&p.push(this.T.video);return[].concat(g.K(new Set(p)))};
g.m(m_f,oU);m_f.prototype.C=function(){var p=[];this.T.parentPlaylist&&p.push(this.T.parentPlaylist);if(this.T.entries)for(var C=g.F(this.T.entries),V=C.next();!V.done;V=C.next())p.push.apply(p,g.K((new JEp(V.value)).C()));return[].concat(g.K(new Set(p)))};
g.m(v3f,oU);v3f.prototype.C=function(){var p=[];this.T.descriptionEntity&&p.push(this.T.descriptionEntity);this.T.creators&&p.push.apply(p,g.K(this.T.creators));this.T.theBiggestFan&&p.push(this.T.theBiggestFan);return[].concat(g.K(new Set(p)))};
g.m(Fn5,oU);Fn5.prototype.C=function(){return[]};
g.m(SVv,oU);SVv.prototype.C=function(){return[]};
g.m(Kn0,oU);Kn0.prototype.C=function(){return[]};
g.m(D_1,oU);D_1.prototype.C=function(){return[]};
g.m(ufE,oU);ufE.prototype.C=function(){return[]};
g.m(ZEv,oU);ZEv.prototype.C=function(){return[]};
g.m(U_P,oU);U_P.prototype.C=function(){return[]};
g.m(fq1,oU);fq1.prototype.C=function(){return[]};
g.m(OEY,oU);OEY.prototype.C=function(){return[]};
g.m(yE2,oU);yE2.prototype.C=function(){var p=[];this.T.downloadsList&&p.push(this.T.downloadsList);this.T.smartDownloadsList&&p.push(this.T.smartDownloadsList);this.T.recommendedDownloadsList&&p.push(this.T.recommendedDownloadsList);this.T.refresh&&p.push(this.T.refresh);return[].concat(g.K(new Set(p)))};
g.m(qV5,Ai);qV5.prototype.C=function(){var p=[];this.T.video&&p.push(this.T.video);this.T.playlist&&p.push(this.T.playlist);this.T.videoItem&&p.push(this.T.videoItem);this.T.playlistItem&&p.push(this.T.playlistItem);return[].concat(g.K(new Set(p)))};
g.m(Iq8,oU);Iq8.prototype.C=function(){var p=[];this.T.refresh&&p.push(this.T.refresh);if(this.T.downloads)for(var C=g.F(this.T.downloads),V=C.next();!V.done;V=C.next())p.push.apply(p,g.K((new qV5(V.value)).C()));return[].concat(g.K(new Set(p)))};
g.m(bEv,oU);bEv.prototype.C=function(){var p=[];this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));return[].concat(g.K(new Set(p)))};
g.m(AEc,oU);AEc.prototype.C=function(){var p=[];this.T.playbackData&&p.push(this.T.playbackData);this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));this.T.videoDownloadContextEntity&&p.push(this.T.videoDownloadContextEntity);return[].concat(g.K(new Set(p)))};
g.m(o3p,oU);o3p.prototype.C=function(){return[]};
g.m(ki1,oU);ki1.prototype.C=function(){var p=[];this.T.fakeChildren&&p.push.apply(p,g.K(this.T.fakeChildren));return[].concat(g.K(new Set(p)))};
g.m(x_F,oU);x_F.prototype.C=function(){var p=[];this.T.video&&p.push(this.T.video);this.T.playbackData&&p.push(this.T.playbackData);this.T.offlineVideoPolicy&&p.push(this.T.offlineVideoPolicy);return[].concat(g.K(new Set(p)))};
g.m(YVr,oU);YVr.prototype.C=function(){return[]};
g.m(zpf,oU);zpf.prototype.C=function(){var p=[];this.T.channelOwner&&p.push(this.T.channelOwner);this.T.videos&&p.push.apply(p,g.K(this.T.videos));this.T.collaboratorChannels&&p.push.apply(p,g.K(this.T.collaboratorChannels));this.T.downloadState&&p.push(this.T.downloadState);this.T.refresh&&p.push(this.T.refresh);return[].concat(g.K(new Set(p)))};
g.m(Rpy,oU);Rpy.prototype.C=function(){var p=[];this.T.video&&p.push(this.T.video);this.T.channelContributor&&p.push(this.T.channelContributor);return[].concat(g.K(new Set(p)))};
g.m(n32,Ai);n32.prototype.C=function(){var p=[];this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));this.T.videoDownloadContextEntity&&p.push(this.T.videoDownloadContextEntity);return[].concat(g.K(new Set(p)))};
g.m(ep5,Ai);ep5.prototype.C=function(){var p=[];this.T.recommendedVideoMetadata&&p.push.apply(p,g.K((new n32(this.T.recommendedVideoMetadata)).C()));return[].concat(g.K(new Set(p)))};
g.m(Ppv,Ai);Ppv.prototype.C=function(){var p=[];this.T.playbackPosition&&p.push(this.T.playbackPosition);return[].concat(g.K(new Set(p)))};
g.m(w22,oU);w22.prototype.C=function(){var p=[];this.T.owner&&p.push(this.T.owner);this.T.downloadState&&p.push(this.T.downloadState);this.T.userState&&p.push.apply(p,g.K((new Ppv(this.T.userState)).C()));this.T.additionalMetadata&&p.push.apply(p,g.K((new ep5(this.T.additionalMetadata)).C()));return[].concat(g.K(new Set(p)))};
g.m($_E,oU);$_E.prototype.C=function(){var p=[];this.T.userChannelDetails&&p.push(this.T.userChannelDetails);return[].concat(g.K(new Set(p)))};
g.m(Lnc,oU);Lnc.prototype.C=function(){var p=[];this.T.channelOwner&&p.push(this.T.channelOwner);this.T.playbackPosition&&p.push(this.T.playbackPosition);this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));this.T.downloadStatus&&p.push(this.T.downloadStatus);return[].concat(g.K(new Set(p)))};
g.m(g3y,oU);g3y.prototype.C=function(){return[]};
g.m(Wn1,oU);Wn1.prototype.C=function(){return[]};
g.m(Qsr,oU);Qsr.prototype.C=function(){return[]};
g.m(rEr,oU);rEr.prototype.C=function(){return[]};
g.m(BhG,oU);BhG.prototype.C=function(){return[]};
g.m(GiE,oU);GiE.prototype.C=function(){return[]};
g.m(psY,oU);psY.prototype.C=function(){return[]};
g.m(CZG,oU);CZG.prototype.C=function(){return[]};
g.m(jof,oU);jof.prototype.C=function(){return[]};
g.m(V1y,oU);V1y.prototype.C=function(){return[]};
g.m(NT0,oU);NT0.prototype.C=function(){var p=[];this.T.trackDownloadMetadatas&&p.push.apply(p,g.K(this.T.trackDownloadMetadatas));return[].concat(g.K(new Set(p)))};
g.m(Hh1,oU);
Hh1.prototype.C=function(){var p=[];this.T.downloadedTracks&&p.push.apply(p,g.K(this.T.downloadedTracks));this.T.smartDownloadedTracks&&p.push.apply(p,g.K(this.T.smartDownloadedTracks));this.T.downloadedEpisodes&&p.push.apply(p,g.K(this.T.downloadedEpisodes));this.T.downloadedAlbumReleases&&p.push.apply(p,g.K(this.T.downloadedAlbumReleases));this.T.smartDownloadedAlbumReleases&&p.push.apply(p,g.K(this.T.smartDownloadedAlbumReleases));this.T.downloadedPlaylists&&p.push.apply(p,g.K(this.T.downloadedPlaylists));this.T.smartDownloadedPlaylists&&
p.push.apply(p,g.K(this.T.smartDownloadedPlaylists));this.T.metadataOnlyTracks&&p.push.apply(p,g.K(this.T.metadataOnlyTracks));return[].concat(g.K(new Set(p)))};
g.m(Xsc,oU);Xsc.prototype.C=function(){var p=[];this.T.trackDownloadMetadatas&&p.push.apply(p,g.K(this.T.trackDownloadMetadatas));return[].concat(g.K(new Set(p)))};
g.m(dk0,oU);dk0.prototype.C=function(){var p=[];this.T.playbackData&&p.push(this.T.playbackData);this.T.localImageEntities&&p.push.apply(p,g.K(this.T.localImageEntities));this.T.videoDownloadContextEntity&&p.push(this.T.videoDownloadContextEntity);return[].concat(g.K(new Set(p)))};
g.m(ihF,oU);ihF.prototype.C=function(){var p=[];this.T.musicLibraryStatusEntity&&p.push(this.T.musicLibraryStatusEntity);this.T.primaryArtists&&p.push.apply(p,g.K(this.T.primaryArtists));this.T.details&&p.push(this.T.details);this.T.userDetails&&p.push(this.T.userDetails);this.T.tracks&&p.push.apply(p,g.K(this.T.tracks));this.T.share&&p.push(this.T.share);this.T.downloadMetadata&&p.push(this.T.downloadMetadata);this.T.refresh&&p.push(this.T.refresh);return[].concat(g.K(new Set(p)))};
g.m(hu1,oU);hu1.prototype.C=function(){var p=[];this.T.albumRelease&&p.push(this.T.albumRelease);this.T.tracks&&p.push.apply(p,g.K(this.T.tracks));return[].concat(g.K(new Set(p)))};
g.m(sop,oU);sop.prototype.C=function(){var p=[];this.T.albumRelease&&p.push(this.T.albumRelease);return[].concat(g.K(new Set(p)))};
g.m(aeG,oU);aeG.prototype.C=function(){var p=[];this.T.details&&p.push(this.T.details);this.T.userDetails&&p.push(this.T.userDetails);return[].concat(g.K(new Set(p)))};
g.m(EcE,oU);EcE.prototype.C=function(){var p=[];this.T.parentArtist&&p.push(this.T.parentArtist);return[].concat(g.K(new Set(p)))};
g.m(ler,oU);ler.prototype.C=function(){var p=[];this.T.parentArtist&&p.push(this.T.parentArtist);return[].concat(g.K(new Set(p)))};
g.m(t1y,oU);t1y.prototype.C=function(){return[]};
g.m(cUp,oU);cUp.prototype.C=function(){return[]};
g.m(TTY,Ai);TTY.prototype.C=function(){var p=[];this.T.creatorEntity&&p.push(this.T.creatorEntity);return[].concat(g.K(new Set(p)))};
g.m(M1p,oU);
M1p.prototype.C=function(){var p=[];this.T.tracks&&p.push.apply(p,g.K(this.T.tracks));this.T.refresh&&p.push(this.T.refresh);this.T.musicLibraryStatusEntity&&p.push(this.T.musicLibraryStatusEntity);this.T.details&&p.push(this.T.details);this.T.downloadMetadata&&p.push(this.T.downloadMetadata);this.T.sideloadMetadata&&p.push(this.T.sideloadMetadata);this.T.userDetails&&p.push(this.T.userDetails);this.T.entryCollection&&p.push(this.T.entryCollection);this.T.share&&p.push(this.T.share);this.T.podcastShowAdditionalMetadata&&p.push.apply(p,
g.K((new TTY(this.T.podcastShowAdditionalMetadata)).C()));return[].concat(g.K(new Set(p)))};
g.m(JUE,oU);JUE.prototype.C=function(){return[]};
g.m(mkG,oU);
mkG.prototype.C=function(){var p=[];this.T.musicLibraryStatusEntity&&p.push(this.T.musicLibraryStatusEntity);this.T.artists&&p.push.apply(p,g.K(this.T.artists));this.T.audioModeVersion&&p.push(this.T.audioModeVersion);this.T.videoModeVersion&&p.push(this.T.videoModeVersion);this.T.userDetails&&p.push(this.T.userDetails);this.T.details&&p.push(this.T.details);this.T.albumRelease&&p.push(this.T.albumRelease);this.T.share&&p.push(this.T.share);this.T.libraryEdit&&p.push(this.T.libraryEdit);this.T.downloadMetadata&&
p.push(this.T.downloadMetadata);this.T.playbackPosition&&p.push(this.T.playbackPosition);this.T.lyrics&&p.push(this.T.lyrics);return[].concat(g.K(new Set(p)))};
g.m(vcr,oU);vcr.prototype.C=function(){var p=[];this.T.parentTrack&&p.push(this.T.parentTrack);return[].concat(g.K(new Set(p)))};
g.m(Fgp,oU);Fgp.prototype.C=function(){var p=[];this.T.parentTrack&&p.push(this.T.parentTrack);return[].concat(g.K(new Set(p)))};
g.m(Shy,oU);Shy.prototype.C=function(){return[]};
g.m(KgP,oU);KgP.prototype.C=function(){return[]};
g.m(Dk5,oU);Dk5.prototype.C=function(){return[]};
g.m(uL2,oU);uL2.prototype.C=function(){return[]};
g.m(Zh0,oU);Zh0.prototype.C=function(){var p=[];this.T.transfer&&p.push(this.T.transfer);this.T.adsPlaybackData&&p.push.apply(p,g.K(this.T.adsPlaybackData));this.T.drmLicense&&p.push(this.T.drmLicense);this.T.offlineVideoPolicy&&p.push(this.T.offlineVideoPolicy);this.T.videoDownloadContextEntity&&p.push(this.T.videoDownloadContextEntity);return[].concat(g.K(new Set(p)))};
g.m(UkY,oU);UkY.prototype.C=function(){return[]};
g.m(fep,oU);fep.prototype.C=function(){var p=[];this.T.offlineVideoStreams&&p.push.apply(p,g.K(this.T.offlineVideoStreams));this.T.captionTrack&&p.push.apply(p,g.K(this.T.captionTrack));return[].concat(g.K(new Set(p)))};
g.m(OhY,oU);OhY.prototype.C=function(){return[]};
g.m(yUp,oU);yUp.prototype.C=function(){return[]};
g.m(qhr,oU);qhr.prototype.C=function(){return[]};
g.m(Ie1,oU);Ie1.prototype.C=function(){return[]};
g.m(bhv,oU);bhv.prototype.C=function(){return[]};
g.m(AU2,oU);AU2.prototype.C=function(){return[]};
g.m(ocy,oU);ocy.prototype.C=function(){return[]};
g.m(kyy,oU);kyy.prototype.C=function(){return[]};
g.m(xk0,oU);xk0.prototype.C=function(){return[]};
g.m(Yhc,oU);Yhc.prototype.C=function(){return[]};
g.m(zuP,oU);zuP.prototype.C=function(){return[]};
g.m(Ru0,oU);Ru0.prototype.C=function(){return[]};
g.m(nc8,oU);nc8.prototype.C=function(){return[]};
g.m(eu2,oU);eu2.prototype.C=function(){return[]};
g.m(PZG,oU);PZG.prototype.C=function(){return[]};
g.m(wsf,oU);wsf.prototype.C=function(){return[]};
g.m($kp,oU);$kp.prototype.C=function(){return[]};
var ez1=["browse","music/browse","unplugged/browse"],gCf=["offline/playlist_sync_check"],boG=["offline"],Pf2=["offline/offline_video_playback_position_sync"],$ZE=["offline/get_playback_data_entity"],k8;x8.getInstance=function(){return g.I(function(p){return p.return(new Promise(function(C){g.Vt().then(function(V){V?(x8.instance||(x8.instance=new x8(V)),C(x8.instance)):C(void 0)})}))})};
x8.prototype.get=function(p){var C=this,V,N,H;return g.I(function(X){if(X.C==1)return g.y(X,QoE(C.token),2);if(X.C!=3)return V=X.T,g.y(X,V.get("prefs",p),3);N=X.T;if(!N)return X.return();H=(0,g.Ip)();return N.expirationTimestampMs<=H?X.return():X.return(N.value)})};
x8.prototype.set=function(p,C,V){V=V===void 0?31536E3:V;var N=this,H,X,d;return g.I(function(a){if(a.C==1)return H=(0,g.Ip)(),X={key:p,value:C,expirationTimestampMs:H+V*1E3},g.y(a,QoE(N.token),2);d=a.T;return g.y(a,g.Yt(d,"prefs",X),0)})};
x8.prototype.remove=function(p){var C=this,V;return g.I(function(N){if(N.C==1)return g.y(N,QoE(C.token),2);V=N.T;return g.y(N,V.delete("prefs",p),0)})};
g.m(Y8,g.Bw);g.m(za,C41);za.prototype.V=function(p,C){C=Vhy(C);p=(new TextEncoder).encode(JSON.stringify(p));return this.T.encrypt(p,C)};
za.prototype.C=function(p,C){if(!(p instanceof Uint8Array))throw rUP(1);var V=new TextDecoder;C=Vhy(C);p=this.T.decrypt(p,C);return JSON.parse(V.decode(p))};
var N9F={accountLinkStatusEntity:Kn0,booleanEntity:cEY,buttonEntity:Yhc,captionTrack:Shy,channelHandle:lq0,commerceAcquisitionClientPayloadEntity:Ru0,commerceCartListEntity:nc8,contextNoteFeedEntityPayload:tZE,continuationTokenEntity:YVr,downloadQualityPickerEntity:U_P,downloadsPageRefreshTokenEntity:OEY,downloadsPageViewConfigurationEntity:g3y,downloadStatusEntity:fq1,sfvAudioItemCurrentlyPlayingEntity:yUp,emojiFountainDataEntity:kyy,emojiCustomizationSetEntity:ocy,fakeChannel:Thf,fakePlaylist:MZv,
fakePlaylistEntryCollection:m_f,fakeVideo:v3f,fakeVideoDescription:Fn5,featuredProductsEntity:CZG,flowStateEntity:SVv,iconBadgeEntity:eu2,interstitialInteractionStateEntity:ufE,liveChatPollStateEntity:ZEv,liveReactionsDataEntity:xk0,logoEntity:D_1,macroMarkerEntity:Wn1,mainDownloadsLibraryEntity:yE2,mainDownloadsListEntity:Iq8,mainPlaylistDownloadStateEntity:bEv,mainPlaylistEntity:zpf,mainPlaylistVideoEntity:Rpy,mainVideoDownloadStateEntity:AEc,mainVideoEntity:w22,markersEngagementPanelSyncEntity:Qsr,
markersVisibilityOverrideEntity:rEr,musicAlbumReleaseDetail:hu1,musicAlbumReleaseDownloadMetadataEntity:NT0,musicAlbumRelease:ihF,musicAlbumReleaseUserDetail:sop,musicArtistDetail:EcE,musicArtist:aeG,musicArtistUserDetail:ler,musicDownloadsLibraryEntity:Hh1,musicLibraryEdit:t1y,musicLibraryStatusEntity:cUp,musicPlaylist:M1p,musicPlaylistDownloadMetadataEntity:Xsc,musicShare:JUE,musicTrackDetail:vcr,musicTrackDownloadMetadataEntity:dk0,musicTrack:mkG,musicTrackUserDetail:Fgp,offlineOrchestrationActionWrapperEntity:KgP,
offlineVideoPolicy:Dk5,offlineVideoStreams:uL2,offlineabilityEntity:o3p,orchestrationWebSamplingEntity:ki1,pageHeaderEntity:bhv,pdpStateEntity:PZG,pinnedProductEntity:jof,playbackData:Zh0,playerStateEntity:BhG,quantityIncrementerEntity:wsf,refresh:UkY,saveToPlaylistListEntity:qhr,settingEntity:Ie1,suggestedFeedbackChipStateEntity:GiE,transfer:fep,trendingOfferEntity:V1y,videoDownloadContextEntity:OhY,videoOverviewAsyncDataEntity:$kp,videoPlaybackPositionEntity:zuP,votingEntity:AU2,ytMainChannelEntity:$_E,
youchatPendingResponseEntity:psY,ytMainDownloadedVideoEntity:x_F,ytMainVideoEntity:Lnc};g.m($8,C41);$8.prototype.V=function(p){return p};
$8.prototype.C=function(p){if(p instanceof Uint8Array)throw rUP(0);return p};
g.m(LC,g.Y);LC.prototype.observe=function(p){var C=this;this.observers.push(p);return function(){var V=C.observers.indexOf(p);V>=0&&C.observers.splice(V,1)}};
LC.prototype.C=function(p){Jxp(this,p.data)};
LC.prototype.CS=function(){this.channel.close()};
var KG0,mZp=new g.I6("elementsCommand");var D2=new g.I6("entityBatchUpdate");var dZv=new g.I6("downloadStatusEntity");var Klf=new g.I6("mainPlaylistEntityActionMetadata");var QZ=new g.I6("mainVideoEntityActionMetadata");var IAG=new g.I6("musicPlaylistEntityActionMetadata");var Nff=new g.I6("musicTrackEntityActionMetadata");var Yd1=new g.I6("localImageEntityActionMetadata");var oz=new g.I6("playbackDataActionMetadata");var vIp=new g.I6("transferEntityActionMetadata");var HX2=new g.I6("videoPlaybackPositionEntityActionMetadata");var YE8;new g.Zt;new g.Zt;P4E.prototype.request=function(p,C,V){C=C===void 0?{}:C;return this.locks.request(p,C,function(N){return V(N)})};var C8=g.xH.caches,p8,WGf;Ga.prototype.open=function(p){return C8.open(LGv(p))};
Ga.prototype.has=function(p){return C8.has(LGv(p))};
Ga.prototype.delete=function(p){return C8.delete(LGv(p))};
Ga.prototype.match=function(p,C){var V=this,N,H,X,d,a,E;return g.I(function(l){switch(l.C){case 1:return g.y(l,V.keys(),2);case 2:N=l.T,H=g.F(N),X=H.next();case 3:if(X.done){l.EY(5);break}d=X.value;return g.y(l,V.open(d),6);case 6:return a=l.T,g.y(l,a.match(p,C),7);case 7:if(E=l.T)return l.return(E);X=H.next();l.EY(3);break;case 5:return l.return()}})};
g.m($K2,Ga);$K2.prototype.keys=function(){var p,C,V,N,H,X,d,a,E;return g.I(function(l){if(l.C==1)return p=[],C=g.GW("CacheStorage keys"),g.y(l,C8.keys(),2);V=l.T;N=g.F(V);for(H=N.next();!H.done;H=N.next()){X=H.value;var t=X.indexOf(":");d=t===-1?{z5:X}:{z5:X.substring(0,t),datasyncId:X.substring(t+1)};a=d.z5;E=d.datasyncId;E===C&&p.push(a)}return l.return(p)})};g.m(VZ,g.Y);VZ.prototype.V=function(p){this.api.Jk("onOfflineOperationFailure",p.data)};
VZ.prototype.S=function(p){this.api.publish("offlinetransferpause",p.data)};
VZ.prototype.CS=function(){var p;(p=this.T)==null||p.close();var C;(C=this.C)==null||C.close()};B9p.prototype.JE=function(){this.T&&HK(this)};
B9p.prototype.j8=function(){this.C&&this.C.resolve();this.V=this.T=!1;this.Z()};var koY=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Tx0="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var UZF="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.m(Q11,Iz);Q11.prototype.C=function(p){return hg(p)?G2v(this,p):az(p)?jq5(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.m(V0y,Iz);V0y.prototype.C=function(p){return az(p)?NEY(this,p):XpG(p)?Xop(this,p):Es(p)?dPP(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.h=iXr.prototype;g.h.Jk$=function(p){var C=this,V,N,H,X;return g.I(function(d){if(!g.r(p.state,128))return d.EY(0);V=p.state.UE;var a=(N=V)==null?void 0:N.errorCode,E=(H=V)==null?void 0:H.PO;X=a==="net.connect"&&E===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(a==null?0:a.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.y(d,C.vn(C.player.getVideoData().videoId,X),0)})};
g.h.vn=function(p,C){var V=this;return g.I(function(N){if(N.C==1){if(V.C)return N.return();V.C=!0;return C==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Yw(V,p,!1,!0),N.EY(0)):g.y(N,xw(V,p),3)}g.us(p,4);return g.y(N,V.T.vn(C),0)})};
g.h.yG=function(p){p.status===2?(p.status!==this.V&&(N0r(this.T),g.us(p.videoId,2)),p.wA&&hop(this.T,p.videoId,p.wA)):p.status===4?(xw(this,p.videoId),this.vn(p.videoId,p.tR?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):p.status===1&&ig0(this.T);this.V=p.status;this.api.Jk("localmediachange",{videoId:p.videoId,status:p.status})};
g.h.By=function(){var p=this,C;return g.I(function(V){if(V.C==1){if(p.C)return V.return();p.C=!0;C=p.player.getVideoData().videoId;return g.y(V,xw(p,C),2)}return g.y(V,p.T.By(),0)})};
g.h.Cy=function(p){switch(p){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.h.G=function(p){return this.api.K().G(p)};g.m(cCr,Iz);cCr.prototype.C=function(p){return hg(p)?M0v(this,p):az(p)?JCG(this,p):XpG(p)?mP2(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};ulF.prototype.T=function(p,C){var V=p.action.actionMetadata.priority-C.action.actionMetadata.priority;V===0&&(p.T<C.T?V=-1:p.T>C.T&&(V=1));return V};g.m(zY,g.Y);zY.prototype.CS=function(){this.Z&&this.Z();g.Y.prototype.CS.call(this)};
zY.prototype.createAction=function(p,C){var V=g.tq(p.entityKey).entityType,N=g.OI(16);return new Mw(V,N,p,C.actionId,C.rootActionId)};
zY.prototype.b_=function(p){var C=this,V,N,H,X,d,a,E,l,t;return g.I(function(c){if(c.C==1){if(C.fS())return c.return();N=(V=p.offlineOrchestrationActionWrapperEntity)!=null?V:new Set;H=[];X=g.F(N);for(d=X.next();!d.done;d=X.next())a=d.value,E=g.tq(a),l=E.entityId,fKc(C.T,l)||H.push(a);return g.y(c,zFf(C,H),2)}t=c.T;return g.y(c,YMP(C,t),0)})};
zY.prototype.retry=function(){var p=this;return g.I(function(C){return g.y(C,RFE(p),0)})};eFy.prototype.m$=function(p,C){C=C===void 0?!0:C;var V=this,N,H,X,d,a,E,l,t;return g.I(function(c){switch(c.C){case 1:if(!V.T)return c.return();N=[];H=g.vx(V.T.T,C);X=[];for(d={rZ:0};d.rZ<H.length;d={rZ:d.rZ},d.rZ++)a=H[d.rZ],E=V.T.Es(a,"json3"),l=g.oK(E,{withCredentials:!0,format:"RAW"},3,500).then(function(T){return function(M){M={metadata:g.sj(H[T.rZ]),trackData:M.xhr.responseText};X.push(M)}}(d)).Rz(function(T){jx("Caption fetch error",T)}),N.push(l);
return g.y(c,E30(N),2);case 2:return g.vv(c,3),g.y(c,qEP(p,X),5);case 5:g.Fe(c,0);break;case 3:t=g.Sa(c),jx("Caption DB transaction error",t),g.JQ(c)}})};g.m(Rz,g.Y);Rz.prototype.CS=function(){this.C&&this.C();g.Y.prototype.CS.call(this)};
Rz.prototype.V=function(p){var C=this,V,N,H,X,d,a,E,l;return g.I(function(t){N=(V=p.transfer)!=null?V:new Set;H=[];X=g.F(N);for(d=X.next();!d.done;d=X.next())a=d.value,E=g.tq(a),l=E.entityId,H.push(l);return H.length===0?t.return():g.y(t,$PY(C,H),0)})};g.m(rCr,g.Y);g.h=rCr.prototype;g.h.CS=function(){this.sY&&this.sY();this.Vn.dispose();this.S.dispose();this.vr&&g.GO(this.Y.FV,this.vr);this.Wr&&g.GO(this.Y.FV,this.Wr);g.Y.prototype.CS.call(this)};
g.h.ccr=function(p){var C=this,V,N,H;return g.I(function(X){switch(X.C){case 1:V=g.cJ(p,"transfer");if(C.T&&V===C.T.key){Yw(C.D,C.W,!0);C.S.stop();X.EY(0);break}return g.y(X,gp(C.C,{mode:"readwrite",L4:!0},function(d){return RU(d,V,"transfer").then(function(a){if(a&&a.transferState!=="TRANSFER_STATE_COMPLETE"&&a.transferState!=="TRANSFER_STATE_FAILED")return a.transferState="TRANSFER_STATE_PAUSED_BY_USER",P9(d,a,"transfer").then(function(){return a})})}),3);
case 3:N=X.T;if(!N){X.EY(0);break}if(!p||!C.V){X.EY(5);break}return g.y(X,ll(p,C.V,C.C,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.y(X,PK(C,p),7);case 7:H=X.T,NxP({videoId:p,NB:N,offlineModeType:H}),g.JQ(X)}})};
g.h.qZS=function(){var p=this;if(this.T&&this.W){Yw(this.D,this.W,!1);var C=this.T,V=(C==null?0:C.key)?g.tq(C.key).entityId:"";V&&this.V&&(new Promise(function(N,H){ll(V,p.V,p.C,"DOWNLOAD_STATE_PAUSED").catch(function(X){H(X)})})).catch(function(N){jx("Download state setting error",N)})}this.S.stop()};
g.h.Ey=function(){this.T?pFf(this,this.T):ex(this)};
g.h.H7=function(p){var C=this;return g.I(function(V){switch(V.C){case 1:if(!C.T){V.EY(2);break}if(C.T.transferState==="TRANSFER_STATE_COMPLETE"||C.T.transferState==="TRANSFER_STATE_FAILED"||!p.transfer||!p.transfer.has(C.T.key)){V.EY(3);break}return g.y(V,Qa(C.C,C.T.key,"transfer"),4);case 4:C.T=V.T;if(C.T){V.EY(3);break}return g.y(V,CI5(C),3);case 3:if(C.T)return V.return();case 2:return g.y(V,ex(C),0)}})};
g.h.vn=function(p,C){var V=this,N,H,X,d,a;return g.I(function(E){switch(E.C){case 1:if(!V.T){wQ(V,"onTransferFailure: "+p);E.EY(2);break}N=V.T;X=((H=N)==null?0:H.key)?g.tq(N.key).entityId:"";a:switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var l=!1;break a;default:l=!0}return l&&sLp(V)?g.y(E,$w(V,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.y(E,
aJ1(V,p),5);case 5:if(!X||!V.V){E.EY(2);break}return g.y(E,ll(X,V.V,V.C,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.y(E,PK(V,X),9);case 9:d=E.T;dQ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:X,NB:N,offlineModeType:d});if(!X||!V.V){E.EY(2);break}return g.y(E,ll(X,V.V,V.C,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:n8(V),a=ex(V,!0),C&&C(a),g.JQ(E)}})};
g.h.By=function(p){var C=this,V,N,H,X,d,a,E,l,t,c,T,M;return g.I(function(J){switch(J.C){case 1:if(!C.T){wQ(C,"onMaybeTransferStreamsExpired");J.EY(2);break}return sLp(C)?g.y(J,$w(C,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.y(J,aJ1(C,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!C.V){J.EY(2);break}V=C.T;H=((N=V)==null?0:N.key)?g.tq(V.key).entityId:"";if(!H){J.EY(2);break}return g.y(J,ll(H,C.V,C.C,"DOWNLOAD_STATE_FAILED"),2);case 9:return C.T||wQ(C,"onMaybeTransferStreamsExpiredRetryAttempting"),
X=C.T,a=((d=X)==null?0:d.key)?g.tq(X.key).entityId:"",g.y(J,PK(C,a),10);case 10:return E=J.T,dQ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:a,NB:X,offlineModeType:E}),l=s1Y(),g.g7(l,oz,{isEnqueuedForExpiredStreamUrlRefetch:!0}),t=g.cJ(a,"playbackData"),c={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:t,actionMetadata:l},T=vK(new Mw("playbackData",a,c)),g.y(J,W9(C.C,T,"offlineOrchestrationActionWrapperEntity"),2);case 2:n8(C),M=ex(C,!0),
p&&p(M),g.JQ(J)}})};
var cp0={},EFp=(cp0.TRANSFER_STATE_TRANSFERRING=1,cp0.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,cp0);g.h=L8.prototype;g.h.m2=function(){return this.W.promise};
g.h.Qh=function(){if(this.C&&this.D)return this.W.promise;ck8(this).then(this.W.resolve).catch(this.W.reject);return this.W.promise};
g.h.cO=function(p){var C={};return C.playbackData=new Q11(p,this.yn,this.T),C.transfer=new cCr(p,this.yn),C.videoPlaybackPositionEntity=new V0y(p,this.yn),C};
g.h.MM=function(){var p=this;return g.I(function(C){return p.C?g.y(C,BEp(p.C),0):C.EY(0)})};
g.h.Xi=function(){var p=this,C,V;return g.I(function(N){if(N.C==1)return p.C||p.D?g.y(N,p.m2(),2):N.return();p.J!==void 0&&(g.Dr(p.J),p.J=void 0);p.S!==void 0&&(g.Dr(p.S),p.S=void 0);(C=p.C)==null||C.dispose();p.C=void 0;(V=p.D)==null||V.dispose();p.D=void 0;p.api.Jk("onOrchestrationLostLeader");p.W=new g.Zt;g.JQ(N)})};
g.h.isOrchestrationLeader=function(){return this.V.T};
g.h.ZB=function(){return g.I(function(p){return p.return(!1)})};
g.h.EP=function(p){var C=this.T;C.api.publish("offlinetransferpause",p);var V;(V=C.C)==null||V.postMessage(p)};
g.h.Ey=function(p){var C,V;return g.I(function(N){if(N.C==1)return g.y(N,B9(),2);C=N.T;if(!C)return N.return();V=g.cJ(p,"transfer");return g.y(N,gp(C,{mode:"readwrite",L4:!0},function(H){var X=RU(H,V,"transfer"),d=RU(H,g.cJ(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.f3.all([X,d]).then(function(a){a=g.F(a);var E=a.next().value;var l=a.next().value;return E&&E.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(E.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",P9(H,E,"transfer").then(function(){dQ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:p,NB:E,offlineModeType:l==null?void 0:l.offlineModeType});return g.f3.resolve(null)})):g.f3.resolve(null)})}),0)})};
g.h.DY=function(p){p=p===void 0?43200:p;var C=this,V,N,H,X,d,a,E,l;return g.I(function(t){if(t.C==1)return C.Y.nO()?g.y(t,B9(),2):t.return(T0y());if(t.C!=3){V=t.T;if(!V)return t.return([]);N=Date.now()/1E3;return g.y(t,rp(V,"offlineVideoPolicy"),3)}H=t.T;X=[];d=g.F(H);for(a=d.next();!a.done;a=d.next())E=a.value,Number(E.lastUpdatedTimestampSeconds)+p<=N&&(l=g.tq(E.key).entityId,X.push(l));return X.length?t.return(gQ(C,X,C.Z,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):t.return([])})};
g.h.deleteAll=function(){return gQ(this,["!*$_ALL_ENTITIES_!*$"],this.Z,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.h.refreshAllStaleEntities=function(p){var C=this;return g.I(function(V){return V.C==1?g.y(V,C.DY(p),2):V.return(V.T)})};
g.h.setUpPositionSyncInterval=function(p){var C=this;this.S!==void 0&&(g.Dr(this.S),this.S=void 0);var V=p!=null?p:864E5;this.S=g.Se(function(){C.p5(V)},V)};
g.h.p5=function(p){var C=this,V,N,H,X,d,a;return g.I(function(E){switch(E.C){case 1:return g.vv(E,2),g.y(E,x8.getInstance(),4);case 4:V=E.T;if(!V)throw Error("prefStorage is undefined");return g.y(E,V.get("psi"),5);case 5:N=E.T;X=((H=N)==null?0:H.YC)?Number(N.YC)/1E3:0;d=Date.now();if(!(X+p<=d)){E.EY(6);break}return g.y(E,gQ(C,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Fe(E,0);break;case 2:a=g.Sa(E),jx("Offline manager error",a),
g.JQ(E)}})};
g.h.Xv=function(){var p=this,C,V,N,H,X,d,a;return g.I(function(E){if(E.C==1)return g.y(E,B9(),2);if(E.C!=3)return(C=E.T)?g.y(E,rp(C,"transfer"),3):E.return([]);V=E.T;N=[];H=g.F(V);for(X=H.next();!X.done;X=H.next())d=X.value,d.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&d.key&&(a=g.tq(d.key).entityId,N.push(a));return E.return(JkF(p,N))})};
g.h.jp=function(){return g.I(function(p){return p.return([])})};
g.h.XM=function(){return g.I(function(p){g.JQ(p)})};
g.h.nE=function(){return g.I(function(p){g.JQ(p)})};g.m(m80,Iz);m80.prototype.C=function(p){return hg(p)?SdY(this,p):az(p)?D82(this,p):Es(p)?uVY(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var WK=[10];g.m(ykY,Iz);ykY.prototype.C=function(p){return hg(p)?bgc(this,p):az(p)?AkE(this,p):Es(p)?oF5(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var IJy=[10];g.m(x88,Iz);x88.prototype.C=function(p){return az(p)?zoy(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.m(Ror,L8);g.h=Ror.prototype;g.h.cO=function(p){var C=L8.prototype.cO.call(this,p);C.mainVideoEntity=new ykY(p,this.yn,this.T);C.mainPlaylistEntity=new m80(p,this.yn,this.T);C.mainDownloadsListEntity=new x88(p,this.yn,this.T);return C};
g.h.refreshAllStaleEntities=function(p,C){var V=this,N,H,X,d,a,E,l,t,c,T,M;return g.I(function(J){switch(J.C){case 1:N=[];if(!V.yn.G("web_player_offline_playlist_auto_refresh")){J.EY(2);break}return g.y(J,nFr(V,p,C),3);case 3:N=J.T;case 2:return g.y(J,x8.getInstance(),4);case 4:return H=J.T,g.y(J,(X=H)==null?void 0:X.get("sdois"),5);case 5:return d=J.T,g.y(J,(a=H)==null?void 0:a.get("lmqf"),6);case 6:E=J.T;if(!d){J.EY(7);break}t=N;c=t.concat;return g.y(J,eov(V,d,(l=E)!=null?l:"SD",p===0),8);case 8:N=
c.call(t,J.T);case 7:return T=N,M=T.concat,g.y(J,L8.prototype.refreshAllStaleEntities.call(V,p,C),9);case 9:return N=M.call(T,J.T),J.return(N)}})};
g.h.ZB=function(p){var C,V,N,H,X,d,a,E;return g.I(function(l){if(l.C==1)return g.y(l,B9(),2);if(l.C!=3)return(C=l.T)?g.y(l,Qa(C,g.bS,"mainDownloadsListEntity"),3):l.return(!1);V=l.T;if((N=V)==null?0:(H=N.downloads)==null?0:H.length)for(X=g.cJ(p,"mainVideoEntity"),d=g.F(V.downloads),a=d.next();!a.done;a=d.next())if(E=a.value,E.videoItem===X)return l.return(!0);return l.return(!1)})};
g.h.jp=function(){var p=this,C,V,N,H,X,d,a,E;return g.I(function(l){if(l.C==1)return g.y(l,B9(),2);if(l.C!=3)return(C=l.T)?g.y(l,rp(C,"downloadStatusEntity"),3):l.return([]);V=l.T;N=[];H=g.F(V);for(X=H.next();!X.done;X=H.next())d=X.value,d.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&d.key&&(a=g.tq(d.key).entityId,N.push(a));return N.length?(E={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},l.return(gQ(p,N,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
E))):l.return([])})};
g.h.nE=function(){var p;return g.I(function(C){return C.C==1?g.y(C,B9(),2):(p=C.T)?g.y(C,gp(p,{mode:"readwrite",L4:!0},function(V){return nC(V,"mainVideoEntity").then(function(N){var H=[];N=g.F(N);for(var X=N.next();!X.done;X=N.next()){X=X.value;var d=void 0;(d=X.userState)!=null&&d.playbackPosition||(d=g.tq(X.key).entityId,d={key:g.cJ(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:"0"},H.push(P9(V,d,"videoPlaybackPositionEntity")),X.userState={playbackPosition:d.key},H.push(P9(V,
X,"mainVideoEntity")))}return g.f3.all(H)})}),0):C.return()})};
g.h.XM=function(){var p,C,V,N,H,X,d,a,E,l,t,c,T,M,J,S,D,Z,f,q,A,z,Q,P,VL,au,W,e,B,v,w,C0,FG,Nc,OS,V8,Tp,Bv;return g.I(function(u){if(u.C==1)return g.y(u,B9(),2);if(u.C!=3){p=u.T;if(!p)return u.return();C=g.cJ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.y(u,gp(p,{mode:"readonly",L4:!0},function(U){return g.f3.all([RU(U,C,"mainDownloadsListEntity"),RU(U,g.bS,"mainDownloadsListEntity"),nC(U,"mainVideoEntity"),nC(U,"mainPlaylistEntity")])}),3)}V=u.T;
N=g.F(V);H=N.next().value;X=N.next().value;d=N.next().value;a=N.next().value;E=H;l=X;t=d;c=a;T=new Set;if((M=E)==null?0:(J=M.downloads)==null?0:J.length)for(S=g.F(E.downloads),D=S.next();!D.done;D=S.next())Z=D.value,f=void 0,(q=(f=Z.videoItem)!=null?f:Z.playlistItem)&&T.add(q);if((A=l)==null?0:(z=A.downloads)==null?0:z.length)for(Q=g.F(l.downloads),P=Q.next();!P.done;P=Q.next())VL=P.value,VL.videoItem&&T.add(VL.videoItem);au=new Set;W=[];e=g.F(c);for(B=e.next();!B.done;B=e.next()){v=B.value;if(v.videos)for(w=
g.F(v.videos),C0=w.next();!C0.done;C0=w.next())FG=C0.value,(Nc=JSON.parse(g.tq(FG).entityId).videoId)&&au.add(Nc);v.key&&!T.has(v.key)&&W.push(v.key)}OS=g.F(t);for(V8=OS.next();!V8.done;V8=OS.next())Tp=V8.value,Tp.key&&!T.has(Tp.key)&&(Bv=g.tq(Tp.key).entityId,au.has(Bv)||W.push(Tp.key));return W.length?g.y(u,KO5(p,W),0):u.EY(0)})};g.m(PIF,Iz);PIF.prototype.C=function(p){return hg(p)?$8P(this,p):az(p)?Ll2(this,p):Es(p)?gFv(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var rQ=[10];g.m(QLf,Iz);QLf.prototype.C=function(p){return hg(p)?B08(this,p):az(p)?GzG(this,p):Es(p)?p6E(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var BK=[10];g.m(V7r,Iz);V7r.prototype.C=function(p){return hg(p)?dvc(this,p):az(p)?id0(this,p):Es(p)?hiY(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var X6E=[10];g.m(GY,L8);GY.prototype.cO=function(p){var C=L8.prototype.cO.call(this,p);C.musicTrack=new V7r(p,this.T);C.musicPlaylist=new QLf(p,this.T);C.musicAlbumRelease=new PIF(p,this.T);return C};
GY.prototype.refreshAllStaleEntities=function(p,C){var V=this,N,H,X;return g.I(function(d){if(d.C==1)return g.y(d,aDy(V,p,C),2);if(d.C!=3)return H=N=d.T,X=H.concat,g.y(d,L8.prototype.refreshAllStaleEntities.call(V,p,C),3);N=X.call(H,d.T);return d.return(N)})};g.m(EQE,g.IT);g.h=EQE.prototype;g.h.create=function(){var p=this;g.R(this,this.events);g.wG(this.yn)?this.T=new Ror(this.yn,this.player):g.gk(this.yn)&&(this.T=new GY(this.yn,this.player));this.events.U(this.player,"onPlaybackStartExternal",function(){p.hR()});
this.events.U(this.player,"videodatachange",function(){p.hR()});
this.yn.G("html5_offline_playback_position_sync")&&this.events.U(this.player,"presentingplayerstatechange",this.JL)};
g.h.P_=function(){return!1};
g.h.SW=function(p,C,V,N){var H=this;return g.I(function(X){return H.T?X.return(gQ(H.T,p,C,V,N)):X.return(Promise.reject())})};
g.h.deleteAll=function(){return this.T.deleteAll()};
g.h.DY=function(p){return this.T.DY(p)};
g.h.refreshAllStaleEntities=function(p){return this.T.refreshAllStaleEntities(p)};
g.h.setUpPositionSyncInterval=function(p){this.T.setUpPositionSyncInterval(p)};
g.h.EP=function(p){this.T.EP(p)};
g.h.Ey=function(p){return this.T.Ey(p)};
g.h.hR=function(){var p=this,C;return g.I(function(V){C=p.player.getVideoData();return g.s5(C)?lDP(C)&&p.C!==C.clientPlaybackNonce?g.y(V,t7r(p,C),0):V.EY(0):V.return()})};
g.h.JL=function(p){var C=this,V,N,H,X,d,a,E;return g.I(function(l){if(l.C==1)return V=C.player.getVideoData(),N=V.hg,g.u$(p,2)||g.u$(p,512)?g.y(l,B9(),2):l.return();if(l.C!=3){H=l.T;if(!H)return jx("PES is undefined"),l.return();X=V.videoId;return g.y(l,Qa(H,g.cJ(X,"mainVideoEntity"),"mainVideoEntity"),3)}d=l.T;if(!d)return l.return();a=Math.floor(N).toString();E={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:a}};return g.y(l,C.SW([X],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
E),0)})};
g.h.isOrchestrationLeader=function(){return this.T.isOrchestrationLeader()};
g.h.updateDownloadState=function(p,C){var V,N,H,X;return g.I(function(d){if(d.C==1)return g.y(d,B9(),2);V=d.T;if(!V)return jx("PES is undefined"),d.return();N=g.tq(p);H=N.entityType;X=N.entityId;return g.y(d,ll(X,H,V,C,!0),0)})};g.qA("offline",EQE);})(_yt_player);
